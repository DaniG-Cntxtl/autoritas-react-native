This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  fonts/
    Archivo-Regular.ttf
    Archivo-SemiBold.ttf
    Archivo-Thin.ttf
    Sancoale-Regular.ttf
  login/
    loginLinesRed.mp4
    redPath.mp4
  logos/
    contextualBlack.png
    contextualLogo.png
    logoSmall-White.png
    logoSmall.png
    NagareLogo.svg
    NagareLogoRed.svg
    NagareLogoWhite.svg
  background.png
  bg.svg
  default.png
  google.png
  vite.svg
src/
  assets/
    agent.webp
    autoritas.png
    chat.png
    profile.png
  components/
    cade/
      widgets/
        ActionButtons.vue
        DeviceGrid.vue
        InvoiceSummary.vue
        PlanCard.vue
        RouterDiagnostics.vue
        TroubleshootingGuide.vue
        WidgetRenderer.vue
    livekit/
      LiveKitRoom.vue
      VoiceAssistant.vue
  router/
    index.js
  services/
    agentService.js
    livekitService.ts
    notificationService.js
  stores/
    chatStore.ts
    conversationStore.js
    costStore.ts
    userStore.ts
  views/
    LiveKitChatView.vue
    Login.vue
  App.vue
  index.css
  main.js
.env.example
.gitignore
cloudbuild.yaml
cors.json
index.html
LIVEKIT_CREDENTIALS.md
package.json
postcss.config.js
README.md
tailwind.config.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/logos/NagareLogo.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1920" zoomAndPan="magnify" viewBox="0 0 1440 809.999993" height="1080" preserveAspectRatio="xMidYMid meet" version="1.0"><defs><g/></defs><g fill="#000000" fill-opacity="1"><g transform="translate(109.710938, 497.999995)"><g><path d="M 21.28125 0 L 21.28125 -192.03125 L 55.984375 -192.03125 L 138.015625 -78.65625 C 138.941406 -77.539062 140.054688 -76.003906 141.359375 -74.046875 C 142.671875 -72.085938 143.882812 -70.171875 145 -68.296875 C 146.125 -66.429688 146.875 -64.941406 147.25 -63.828125 L 148.640625 -63.828125 C 148.640625 -66.441406 148.640625 -68.957031 148.640625 -71.375 C 148.640625 -73.800781 148.640625 -76.226562 148.640625 -78.65625 L 148.640625 -192.03125 L 183.640625 -192.03125 L 183.640625 0 L 149.203125 0 L 66.90625 -114.21875 C 65.414062 -116.457031 63.6875 -119.207031 61.71875 -122.46875 C 59.757812 -125.738281 58.410156 -128.023438 57.671875 -129.328125 L 56.265625 -129.328125 C 56.265625 -126.898438 56.265625 -124.425781 56.265625 -121.90625 C 56.265625 -119.394531 56.265625 -116.832031 56.265625 -114.21875 L 56.265625 0 Z M 21.28125 0 "/></g></g></g><g fill="#000000" fill-opacity="1"><g transform="translate(314.6303, 497.999995)"><g><path d="M 55.984375 3.359375 C 51.878906 3.359375 47.164062 2.84375 41.84375 1.8125 C 36.53125 0.789062 31.398438 -1.117188 26.453125 -3.921875 C 21.503906 -6.722656 17.441406 -10.875 14.265625 -16.375 C 11.097656 -21.882812 9.515625 -29.117188 9.515625 -38.078125 C 9.515625 -48.148438 11.753906 -56.5 16.234375 -63.125 C 20.710938 -69.75 27.007812 -74.972656 35.125 -78.796875 C 43.25 -82.628906 52.957031 -85.335938 64.25 -86.921875 C 75.539062 -88.503906 87.90625 -89.296875 101.34375 -89.296875 L 101.34375 -101.34375 C 101.34375 -105.632812 100.6875 -109.457031 99.375 -112.8125 C 98.070312 -116.175781 95.691406 -118.835938 92.234375 -120.796875 C 88.785156 -122.753906 83.609375 -123.734375 76.703125 -123.734375 C 69.796875 -123.734375 64.382812 -122.890625 60.46875 -121.203125 C 56.550781 -119.523438 53.84375 -117.472656 52.34375 -115.046875 C 50.851562 -112.628906 50.109375 -110.113281 50.109375 -107.5 L 50.109375 -103.578125 L 17.078125 -103.578125 C 16.890625 -104.515625 16.796875 -105.445312 16.796875 -106.375 C 16.796875 -107.3125 16.796875 -108.429688 16.796875 -109.734375 C 16.796875 -118.128906 19.3125 -125.40625 24.34375 -131.5625 C 29.382812 -137.726562 36.382812 -142.441406 45.34375 -145.703125 C 54.300781 -148.972656 64.660156 -150.609375 76.421875 -150.609375 C 89.859375 -150.609375 100.914062 -148.738281 109.59375 -145 C 118.269531 -141.269531 124.753906 -135.953125 129.046875 -129.046875 C 133.335938 -122.140625 135.484375 -113.742188 135.484375 -103.859375 L 135.484375 -34.4375 C 135.484375 -30.882812 136.507812 -28.363281 138.5625 -26.875 C 140.613281 -25.382812 142.851562 -24.640625 145.28125 -24.640625 L 154.25 -24.640625 L 154.25 -1.125 C 152.382812 -0.375 149.675781 0.507812 146.125 1.53125 C 142.582031 2.5625 138.195312 3.078125 132.96875 3.078125 C 128.113281 3.078125 123.773438 2.285156 119.953125 0.703125 C 116.128906 -0.878906 112.910156 -3.164062 110.296875 -6.15625 C 107.679688 -9.144531 105.816406 -12.691406 104.703125 -16.796875 L 103.015625 -16.796875 C 99.847656 -12.878906 96.066406 -9.378906 91.671875 -6.296875 C 87.285156 -3.210938 82.15625 -0.832031 76.28125 0.84375 C 70.40625 2.519531 63.640625 3.359375 55.984375 3.359375 Z M 66.34375 -24.640625 C 71.945312 -24.640625 76.941406 -25.476562 81.328125 -27.15625 C 85.710938 -28.832031 89.347656 -31.160156 92.234375 -34.140625 C 95.128906 -37.128906 97.367188 -40.769531 98.953125 -45.0625 C 100.546875 -49.363281 101.34375 -54.03125 101.34375 -59.0625 L 101.34375 -65.78125 C 91.070312 -65.78125 81.597656 -65.125 72.921875 -63.8125 C 64.242188 -62.507812 57.335938 -60.085938 52.203125 -56.546875 C 47.078125 -53.003906 44.515625 -47.96875 44.515625 -41.4375 C 44.515625 -38.070312 45.304688 -35.128906 46.890625 -32.609375 C 48.472656 -30.085938 50.894531 -28.128906 54.15625 -26.734375 C 57.425781 -25.335938 61.488281 -24.640625 66.34375 -24.640625 Z M 66.34375 -24.640625 "/></g></g></g><g fill="#000000" fill-opacity="1"><g transform="translate(470.279465, 497.999995)"><g><path d="M 42.546875 50.953125 C 36.015625 50.953125 29.851562 49.644531 24.0625 47.03125 C 18.28125 44.414062 13.617188 40.539062 10.078125 35.40625 C 6.535156 30.28125 4.765625 23.984375 4.765625 16.515625 C 4.765625 8.304688 7.140625 1.820312 11.890625 -2.9375 C 16.648438 -7.695312 21.925781 -11.289062 27.71875 -13.71875 C 23.425781 -15.957031 19.925781 -18.941406 17.21875 -22.671875 C 14.507812 -26.410156 13.15625 -30.890625 13.15625 -36.109375 C 13.15625 -43.203125 15.765625 -48.847656 20.984375 -53.046875 C 26.210938 -57.242188 32.1875 -60 38.90625 -61.3125 C 32 -65.601562 26.726562 -71.109375 23.09375 -77.828125 C 19.457031 -84.546875 17.640625 -92.195312 17.640625 -100.78125 C 17.640625 -111.039062 20.109375 -119.859375 25.046875 -127.234375 C 29.992188 -134.609375 37.226562 -140.347656 46.75 -144.453125 C 56.269531 -148.554688 67.75 -150.609375 81.1875 -150.609375 C 86.59375 -150.609375 91.816406 -150.234375 96.859375 -149.484375 C 101.898438 -148.734375 106.472656 -147.613281 110.578125 -146.125 C 117.109375 -150.039062 121.585938 -154.472656 124.015625 -159.421875 C 126.441406 -164.367188 127.75 -168.429688 127.9375 -171.609375 L 161.25 -171.609375 C 161.25 -165.066406 159.988281 -159.273438 157.46875 -154.234375 C 154.945312 -149.203125 151.445312 -145.050781 146.96875 -141.78125 C 142.488281 -138.519531 137.078125 -136.144531 130.734375 -134.65625 C 135.398438 -130.539062 138.941406 -125.59375 141.359375 -119.8125 C 143.785156 -114.03125 145 -107.6875 145 -100.78125 C 145 -90.507812 142.617188 -81.640625 137.859375 -74.171875 C 133.109375 -66.710938 126.113281 -60.929688 116.875 -56.828125 C 107.632812 -52.722656 96.296875 -50.671875 82.859375 -50.671875 L 60.1875 -50.671875 C 56.269531 -50.671875 53.238281 -49.828125 51.09375 -48.140625 C 48.945312 -46.460938 47.875 -44.132812 47.875 -41.15625 C 47.875 -38.726562 48.851562 -36.578125 50.8125 -34.703125 C 52.769531 -32.835938 55.519531 -31.90625 59.0625 -31.90625 L 123.453125 -31.90625 C 134.460938 -31.90625 143.5625 -28.3125 150.75 -21.125 C 157.9375 -13.945312 161.53125 -4.757812 161.53125 6.4375 C 161.53125 14.832031 159.332031 22.390625 154.9375 29.109375 C 150.550781 35.828125 144.441406 41.144531 136.609375 45.0625 C 128.773438 48.988281 119.628906 50.953125 109.171875 50.953125 Z M 54.875 26.3125 L 108.890625 26.3125 C 112.441406 26.3125 115.566406 25.703125 118.265625 24.484375 C 120.972656 23.273438 123.117188 21.550781 124.703125 19.3125 C 126.296875 17.070312 127.09375 14.550781 127.09375 11.75 C 127.09375 6.90625 125.550781 3.269531 122.46875 0.84375 C 119.394531 -1.582031 115.617188 -2.796875 111.140625 -2.796875 L 54.875 -2.796875 C 50.394531 -2.796875 46.660156 -1.445312 43.671875 1.25 C 40.679688 3.957031 39.1875 7.457031 39.1875 11.75 C 39.1875 16.050781 40.632812 19.550781 43.53125 22.25 C 46.425781 24.957031 50.207031 26.3125 54.875 26.3125 Z M 81.46875 -74.75 C 91.351562 -74.75 98.769531 -77.03125 103.71875 -81.59375 C 108.664062 -86.164062 111.140625 -92.5625 111.140625 -100.78125 C 111.140625 -108.988281 108.664062 -115.332031 103.71875 -119.8125 C 98.769531 -124.289062 91.351562 -126.53125 81.46875 -126.53125 C 71.570312 -126.53125 64.148438 -124.289062 59.203125 -119.8125 C 54.253906 -115.332031 51.78125 -108.988281 51.78125 -100.78125 C 51.78125 -95.363281 52.851562 -90.695312 55 -86.78125 C 57.15625 -82.863281 60.425781 -79.878906 64.8125 -77.828125 C 69.195312 -75.773438 74.75 -74.75 81.46875 -74.75 Z M 81.46875 -74.75 "/></g></g></g><g fill="#000000" fill-opacity="1"><g transform="translate(635.726644, 497.999995)"><g><path d="M 55.984375 3.359375 C 51.878906 3.359375 47.164062 2.84375 41.84375 1.8125 C 36.53125 0.789062 31.398438 -1.117188 26.453125 -3.921875 C 21.503906 -6.722656 17.441406 -10.875 14.265625 -16.375 C 11.097656 -21.882812 9.515625 -29.117188 9.515625 -38.078125 C 9.515625 -48.148438 11.753906 -56.5 16.234375 -63.125 C 20.710938 -69.75 27.007812 -74.972656 35.125 -78.796875 C 43.25 -82.628906 52.957031 -85.335938 64.25 -86.921875 C 75.539062 -88.503906 87.90625 -89.296875 101.34375 -89.296875 L 101.34375 -101.34375 C 101.34375 -105.632812 100.6875 -109.457031 99.375 -112.8125 C 98.070312 -116.175781 95.691406 -118.835938 92.234375 -120.796875 C 88.785156 -122.753906 83.609375 -123.734375 76.703125 -123.734375 C 69.796875 -123.734375 64.382812 -122.890625 60.46875 -121.203125 C 56.550781 -119.523438 53.84375 -117.472656 52.34375 -115.046875 C 50.851562 -112.628906 50.109375 -110.113281 50.109375 -107.5 L 50.109375 -103.578125 L 17.078125 -103.578125 C 16.890625 -104.515625 16.796875 -105.445312 16.796875 -106.375 C 16.796875 -107.3125 16.796875 -108.429688 16.796875 -109.734375 C 16.796875 -118.128906 19.3125 -125.40625 24.34375 -131.5625 C 29.382812 -137.726562 36.382812 -142.441406 45.34375 -145.703125 C 54.300781 -148.972656 64.660156 -150.609375 76.421875 -150.609375 C 89.859375 -150.609375 100.914062 -148.738281 109.59375 -145 C 118.269531 -141.269531 124.753906 -135.953125 129.046875 -129.046875 C 133.335938 -122.140625 135.484375 -113.742188 135.484375 -103.859375 L 135.484375 -34.4375 C 135.484375 -30.882812 136.507812 -28.363281 138.5625 -26.875 C 140.613281 -25.382812 142.851562 -24.640625 145.28125 -24.640625 L 154.25 -24.640625 L 154.25 -1.125 C 152.382812 -0.375 149.675781 0.507812 146.125 1.53125 C 142.582031 2.5625 138.195312 3.078125 132.96875 3.078125 C 128.113281 3.078125 123.773438 2.285156 119.953125 0.703125 C 116.128906 -0.878906 112.910156 -3.164062 110.296875 -6.15625 C 107.679688 -9.144531 105.816406 -12.691406 104.703125 -16.796875 L 103.015625 -16.796875 C 99.847656 -12.878906 96.066406 -9.378906 91.671875 -6.296875 C 87.285156 -3.210938 82.15625 -0.832031 76.28125 0.84375 C 70.40625 2.519531 63.640625 3.359375 55.984375 3.359375 Z M 66.34375 -24.640625 C 71.945312 -24.640625 76.941406 -25.476562 81.328125 -27.15625 C 85.710938 -28.832031 89.347656 -31.160156 92.234375 -34.140625 C 95.128906 -37.128906 97.367188 -40.769531 98.953125 -45.0625 C 100.546875 -49.363281 101.34375 -54.03125 101.34375 -59.0625 L 101.34375 -65.78125 C 91.070312 -65.78125 81.597656 -65.125 72.921875 -63.8125 C 64.242188 -62.507812 57.335938 -60.085938 52.203125 -56.546875 C 47.078125 -53.003906 44.515625 -47.96875 44.515625 -41.4375 C 44.515625 -38.070312 45.304688 -35.128906 46.890625 -32.609375 C 48.472656 -30.085938 50.894531 -28.128906 54.15625 -26.734375 C 57.425781 -25.335938 61.488281 -24.640625 66.34375 -24.640625 Z M 66.34375 -24.640625 "/></g></g></g><g fill="#000000" fill-opacity="1"><g transform="translate(791.375809, 497.999995)"><g><path d="M 18.203125 0 L 18.203125 -147.25 L 46.75 -147.25 L 49.546875 -124.015625 L 51.515625 -124.015625 C 53.378906 -128.679688 55.660156 -133.019531 58.359375 -137.03125 C 61.066406 -141.039062 64.566406 -144.304688 68.859375 -146.828125 C 73.148438 -149.347656 78.378906 -150.609375 84.546875 -150.609375 C 87.523438 -150.609375 90.273438 -150.328125 92.796875 -149.765625 C 95.316406 -149.203125 97.226562 -148.644531 98.53125 -148.09375 L 98.53125 -115.890625 L 88.1875 -115.890625 C 82.394531 -115.890625 77.257812 -115.097656 72.78125 -113.515625 C 68.300781 -111.929688 64.519531 -109.457031 61.4375 -106.09375 C 58.363281 -102.738281 56.078125 -98.539062 54.578125 -93.5 C 53.085938 -88.457031 52.34375 -82.578125 52.34375 -75.859375 L 52.34375 0 Z M 18.203125 0 "/></g></g></g><g fill="#000000" fill-opacity="1"><g transform="translate(892.715663, 497.999995)"><g><path d="M 81.46875 3.359375 C 65.789062 3.359375 52.722656 0.609375 42.265625 -4.890625 C 31.816406 -10.398438 23.976562 -18.847656 18.75 -30.234375 C 13.53125 -41.617188 10.921875 -56.082031 10.921875 -73.625 C 10.921875 -91.351562 13.53125 -105.863281 18.75 -117.15625 C 23.976562 -128.445312 31.816406 -136.84375 42.265625 -142.34375 C 52.722656 -147.851562 65.789062 -150.609375 81.46875 -150.609375 C 95.644531 -150.609375 107.539062 -147.945312 117.15625 -142.625 C 126.769531 -137.3125 134 -129.148438 138.84375 -118.140625 C 143.695312 -107.128906 146.125 -92.847656 146.125 -75.296875 L 146.125 -65.21875 L 45.90625 -65.21875 C 46.28125 -56.082031 47.679688 -48.382812 50.109375 -42.125 C 52.535156 -35.875 56.3125 -31.207031 61.4375 -28.125 C 66.570312 -25.050781 73.335938 -23.515625 81.734375 -23.515625 C 86.035156 -23.515625 90.050781 -24.070312 93.78125 -25.1875 C 97.507812 -26.3125 100.773438 -28.039062 103.578125 -30.375 C 106.378906 -32.707031 108.570312 -35.644531 110.15625 -39.1875 C 111.738281 -42.738281 112.53125 -46.847656 112.53125 -51.515625 L 146.125 -51.515625 C 146.125 -42.179688 144.488281 -34.0625 141.21875 -27.15625 C 137.957031 -20.25 133.382812 -14.554688 127.5 -10.078125 C 121.625 -5.597656 114.765625 -2.238281 106.921875 0 C 99.085938 2.238281 90.601562 3.359375 81.46875 3.359375 Z M 46.46875 -89.296875 L 110.578125 -89.296875 C 110.578125 -95.453125 109.875 -100.675781 108.46875 -104.96875 C 107.070312 -109.269531 105.113281 -112.816406 102.59375 -115.609375 C 100.070312 -118.410156 97.039062 -120.414062 93.5 -121.625 C 89.957031 -122.84375 85.945312 -123.453125 81.46875 -123.453125 C 74.1875 -123.453125 68.070312 -122.238281 63.125 -119.8125 C 58.175781 -117.382812 54.394531 -113.648438 51.78125 -108.609375 C 49.175781 -103.578125 47.40625 -97.140625 46.46875 -89.296875 Z M 46.46875 -89.296875 "/></g></g></g><g fill="#000000" fill-opacity="1"><g transform="translate(1049.765578, 497.999995)"><g><path d="M 24.921875 0 L 24.921875 -29.390625 L 52.34375 -29.390625 L 52.34375 0 Z M 24.921875 0 "/></g></g></g><g fill="#000000" fill-opacity="1"><g transform="translate(1127.320262, 497.999995)"><g><path d="M 56.546875 3.359375 C 49.828125 3.359375 43.617188 2.5625 37.921875 0.96875 C 32.234375 -0.613281 27.289062 -3.035156 23.09375 -6.296875 C 18.894531 -9.566406 15.628906 -13.71875 13.296875 -18.75 C 10.960938 -23.789062 9.796875 -29.765625 9.796875 -36.671875 C 9.796875 -46.929688 12.40625 -55.234375 17.625 -61.578125 C 22.851562 -67.929688 30.132812 -72.832031 39.46875 -76.28125 C 48.800781 -79.738281 59.8125 -82.070312 72.5 -83.28125 C 85.195312 -84.488281 98.914062 -85.09375 113.65625 -85.09375 L 113.65625 -107.21875 C 113.65625 -113.9375 112.394531 -119.628906 109.875 -124.296875 C 107.351562 -128.960938 102.96875 -132.503906 96.71875 -134.921875 C 90.46875 -137.347656 81.835938 -138.5625 70.828125 -138.5625 C 60.367188 -138.5625 52.109375 -137.207031 46.046875 -134.5 C 39.984375 -131.800781 35.691406 -128.164062 33.171875 -123.59375 C 30.648438 -119.019531 29.390625 -113.929688 29.390625 -108.328125 L 29.390625 -103.578125 L 16.515625 -103.578125 C 16.328125 -104.515625 16.234375 -105.445312 16.234375 -106.375 C 16.234375 -107.3125 16.234375 -108.429688 16.234375 -109.734375 C 16.234375 -119.441406 18.660156 -127.28125 23.515625 -133.25 C 28.367188 -139.21875 35.226562 -143.601562 44.09375 -146.40625 C 52.957031 -149.207031 63.175781 -150.609375 74.75 -150.609375 C 85.757812 -150.609375 95.132812 -148.972656 102.875 -145.703125 C 110.625 -142.441406 116.597656 -137.773438 120.796875 -131.703125 C 124.992188 -125.640625 127.09375 -118.316406 127.09375 -109.734375 L 127.09375 -17.921875 C 127.09375 -14.367188 127.648438 -11.9375 128.765625 -10.625 C 129.890625 -9.320312 131.664062 -8.671875 134.09375 -8.671875 L 147.25 -8.671875 L 147.25 -0.84375 C 143.882812 0.65625 140.800781 1.679688 138 2.234375 C 135.207031 2.796875 132.597656 3.078125 130.171875 3.078125 C 125.128906 3.078125 121.441406 1.910156 119.109375 -0.421875 C 116.773438 -2.753906 115.28125 -5.925781 114.625 -9.9375 C 113.976562 -13.945312 113.65625 -18.285156 113.65625 -22.953125 L 111.6875 -22.953125 C 107.957031 -17.359375 103.109375 -12.597656 97.140625 -8.671875 C 91.171875 -4.753906 84.734375 -1.769531 77.828125 0.28125 C 70.921875 2.332031 63.828125 3.359375 56.546875 3.359375 Z M 57.671875 -8.671875 C 64.015625 -8.671875 70.453125 -9.742188 76.984375 -11.890625 C 83.515625 -14.035156 89.53125 -17.066406 95.03125 -20.984375 C 100.539062 -24.910156 105.019531 -29.625 108.46875 -35.125 C 111.925781 -40.632812 113.65625 -46.75 113.65625 -53.46875 L 113.65625 -72.5 C 92.9375 -72.5 76.046875 -71.425781 62.984375 -69.28125 C 49.921875 -67.132812 40.265625 -63.445312 34.015625 -58.21875 C 27.765625 -53 24.640625 -45.722656 24.640625 -36.390625 C 24.640625 -29.671875 26.128906 -24.257812 29.109375 -20.15625 C 32.097656 -16.050781 36.109375 -13.109375 41.140625 -11.328125 C 46.179688 -9.554688 51.691406 -8.671875 57.671875 -8.671875 Z M 57.671875 -8.671875 "/></g></g></g><g fill="#000000" fill-opacity="1"><g transform="translate(1275.970825, 497.999995)"><g><path d="M 20.4375 -181.125 L 20.4375 -202.390625 L 33.875 -202.390625 L 33.875 -181.125 Z M 20.4375 0 L 20.4375 -147.25 L 33.875 -147.25 L 33.875 0 Z M 20.4375 0 "/></g></g></g></svg>
</file>

<file path="public/logos/NagareLogoRed.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1920" zoomAndPan="magnify" viewBox="0 0 1440 809.999993" height="1080" preserveAspectRatio="xMidYMid meet" version="1.0"><defs><g/></defs><g fill="#ed4556" fill-opacity="1"><g transform="translate(109.710938, 497.999995)"><g><path d="M 21.28125 0 L 21.28125 -192.03125 L 55.984375 -192.03125 L 138.015625 -78.65625 C 138.941406 -77.539062 140.054688 -76.003906 141.359375 -74.046875 C 142.671875 -72.085938 143.882812 -70.171875 145 -68.296875 C 146.125 -66.429688 146.875 -64.941406 147.25 -63.828125 L 148.640625 -63.828125 C 148.640625 -66.441406 148.640625 -68.957031 148.640625 -71.375 C 148.640625 -73.800781 148.640625 -76.226562 148.640625 -78.65625 L 148.640625 -192.03125 L 183.640625 -192.03125 L 183.640625 0 L 149.203125 0 L 66.90625 -114.21875 C 65.414062 -116.457031 63.6875 -119.207031 61.71875 -122.46875 C 59.757812 -125.738281 58.410156 -128.023438 57.671875 -129.328125 L 56.265625 -129.328125 C 56.265625 -126.898438 56.265625 -124.425781 56.265625 -121.90625 C 56.265625 -119.394531 56.265625 -116.832031 56.265625 -114.21875 L 56.265625 0 Z M 21.28125 0 "/></g></g></g><g fill="#ed4556" fill-opacity="1"><g transform="translate(314.6303, 497.999995)"><g><path d="M 55.984375 3.359375 C 51.878906 3.359375 47.164062 2.84375 41.84375 1.8125 C 36.53125 0.789062 31.398438 -1.117188 26.453125 -3.921875 C 21.503906 -6.722656 17.441406 -10.875 14.265625 -16.375 C 11.097656 -21.882812 9.515625 -29.117188 9.515625 -38.078125 C 9.515625 -48.148438 11.753906 -56.5 16.234375 -63.125 C 20.710938 -69.75 27.007812 -74.972656 35.125 -78.796875 C 43.25 -82.628906 52.957031 -85.335938 64.25 -86.921875 C 75.539062 -88.503906 87.90625 -89.296875 101.34375 -89.296875 L 101.34375 -101.34375 C 101.34375 -105.632812 100.6875 -109.457031 99.375 -112.8125 C 98.070312 -116.175781 95.691406 -118.835938 92.234375 -120.796875 C 88.785156 -122.753906 83.609375 -123.734375 76.703125 -123.734375 C 69.796875 -123.734375 64.382812 -122.890625 60.46875 -121.203125 C 56.550781 -119.523438 53.84375 -117.472656 52.34375 -115.046875 C 50.851562 -112.628906 50.109375 -110.113281 50.109375 -107.5 L 50.109375 -103.578125 L 17.078125 -103.578125 C 16.890625 -104.515625 16.796875 -105.445312 16.796875 -106.375 C 16.796875 -107.3125 16.796875 -108.429688 16.796875 -109.734375 C 16.796875 -118.128906 19.3125 -125.40625 24.34375 -131.5625 C 29.382812 -137.726562 36.382812 -142.441406 45.34375 -145.703125 C 54.300781 -148.972656 64.660156 -150.609375 76.421875 -150.609375 C 89.859375 -150.609375 100.914062 -148.738281 109.59375 -145 C 118.269531 -141.269531 124.753906 -135.953125 129.046875 -129.046875 C 133.335938 -122.140625 135.484375 -113.742188 135.484375 -103.859375 L 135.484375 -34.4375 C 135.484375 -30.882812 136.507812 -28.363281 138.5625 -26.875 C 140.613281 -25.382812 142.851562 -24.640625 145.28125 -24.640625 L 154.25 -24.640625 L 154.25 -1.125 C 152.382812 -0.375 149.675781 0.507812 146.125 1.53125 C 142.582031 2.5625 138.195312 3.078125 132.96875 3.078125 C 128.113281 3.078125 123.773438 2.285156 119.953125 0.703125 C 116.128906 -0.878906 112.910156 -3.164062 110.296875 -6.15625 C 107.679688 -9.144531 105.816406 -12.691406 104.703125 -16.796875 L 103.015625 -16.796875 C 99.847656 -12.878906 96.066406 -9.378906 91.671875 -6.296875 C 87.285156 -3.210938 82.15625 -0.832031 76.28125 0.84375 C 70.40625 2.519531 63.640625 3.359375 55.984375 3.359375 Z M 66.34375 -24.640625 C 71.945312 -24.640625 76.941406 -25.476562 81.328125 -27.15625 C 85.710938 -28.832031 89.347656 -31.160156 92.234375 -34.140625 C 95.128906 -37.128906 97.367188 -40.769531 98.953125 -45.0625 C 100.546875 -49.363281 101.34375 -54.03125 101.34375 -59.0625 L 101.34375 -65.78125 C 91.070312 -65.78125 81.597656 -65.125 72.921875 -63.8125 C 64.242188 -62.507812 57.335938 -60.085938 52.203125 -56.546875 C 47.078125 -53.003906 44.515625 -47.96875 44.515625 -41.4375 C 44.515625 -38.070312 45.304688 -35.128906 46.890625 -32.609375 C 48.472656 -30.085938 50.894531 -28.128906 54.15625 -26.734375 C 57.425781 -25.335938 61.488281 -24.640625 66.34375 -24.640625 Z M 66.34375 -24.640625 "/></g></g></g><g fill="#ed4556" fill-opacity="1"><g transform="translate(470.279465, 497.999995)"><g><path d="M 42.546875 50.953125 C 36.015625 50.953125 29.851562 49.644531 24.0625 47.03125 C 18.28125 44.414062 13.617188 40.539062 10.078125 35.40625 C 6.535156 30.28125 4.765625 23.984375 4.765625 16.515625 C 4.765625 8.304688 7.140625 1.820312 11.890625 -2.9375 C 16.648438 -7.695312 21.925781 -11.289062 27.71875 -13.71875 C 23.425781 -15.957031 19.925781 -18.941406 17.21875 -22.671875 C 14.507812 -26.410156 13.15625 -30.890625 13.15625 -36.109375 C 13.15625 -43.203125 15.765625 -48.847656 20.984375 -53.046875 C 26.210938 -57.242188 32.1875 -60 38.90625 -61.3125 C 32 -65.601562 26.726562 -71.109375 23.09375 -77.828125 C 19.457031 -84.546875 17.640625 -92.195312 17.640625 -100.78125 C 17.640625 -111.039062 20.109375 -119.859375 25.046875 -127.234375 C 29.992188 -134.609375 37.226562 -140.347656 46.75 -144.453125 C 56.269531 -148.554688 67.75 -150.609375 81.1875 -150.609375 C 86.59375 -150.609375 91.816406 -150.234375 96.859375 -149.484375 C 101.898438 -148.734375 106.472656 -147.613281 110.578125 -146.125 C 117.109375 -150.039062 121.585938 -154.472656 124.015625 -159.421875 C 126.441406 -164.367188 127.75 -168.429688 127.9375 -171.609375 L 161.25 -171.609375 C 161.25 -165.066406 159.988281 -159.273438 157.46875 -154.234375 C 154.945312 -149.203125 151.445312 -145.050781 146.96875 -141.78125 C 142.488281 -138.519531 137.078125 -136.144531 130.734375 -134.65625 C 135.398438 -130.539062 138.941406 -125.59375 141.359375 -119.8125 C 143.785156 -114.03125 145 -107.6875 145 -100.78125 C 145 -90.507812 142.617188 -81.640625 137.859375 -74.171875 C 133.109375 -66.710938 126.113281 -60.929688 116.875 -56.828125 C 107.632812 -52.722656 96.296875 -50.671875 82.859375 -50.671875 L 60.1875 -50.671875 C 56.269531 -50.671875 53.238281 -49.828125 51.09375 -48.140625 C 48.945312 -46.460938 47.875 -44.132812 47.875 -41.15625 C 47.875 -38.726562 48.851562 -36.578125 50.8125 -34.703125 C 52.769531 -32.835938 55.519531 -31.90625 59.0625 -31.90625 L 123.453125 -31.90625 C 134.460938 -31.90625 143.5625 -28.3125 150.75 -21.125 C 157.9375 -13.945312 161.53125 -4.757812 161.53125 6.4375 C 161.53125 14.832031 159.332031 22.390625 154.9375 29.109375 C 150.550781 35.828125 144.441406 41.144531 136.609375 45.0625 C 128.773438 48.988281 119.628906 50.953125 109.171875 50.953125 Z M 54.875 26.3125 L 108.890625 26.3125 C 112.441406 26.3125 115.566406 25.703125 118.265625 24.484375 C 120.972656 23.273438 123.117188 21.550781 124.703125 19.3125 C 126.296875 17.070312 127.09375 14.550781 127.09375 11.75 C 127.09375 6.90625 125.550781 3.269531 122.46875 0.84375 C 119.394531 -1.582031 115.617188 -2.796875 111.140625 -2.796875 L 54.875 -2.796875 C 50.394531 -2.796875 46.660156 -1.445312 43.671875 1.25 C 40.679688 3.957031 39.1875 7.457031 39.1875 11.75 C 39.1875 16.050781 40.632812 19.550781 43.53125 22.25 C 46.425781 24.957031 50.207031 26.3125 54.875 26.3125 Z M 81.46875 -74.75 C 91.351562 -74.75 98.769531 -77.03125 103.71875 -81.59375 C 108.664062 -86.164062 111.140625 -92.5625 111.140625 -100.78125 C 111.140625 -108.988281 108.664062 -115.332031 103.71875 -119.8125 C 98.769531 -124.289062 91.351562 -126.53125 81.46875 -126.53125 C 71.570312 -126.53125 64.148438 -124.289062 59.203125 -119.8125 C 54.253906 -115.332031 51.78125 -108.988281 51.78125 -100.78125 C 51.78125 -95.363281 52.851562 -90.695312 55 -86.78125 C 57.15625 -82.863281 60.425781 -79.878906 64.8125 -77.828125 C 69.195312 -75.773438 74.75 -74.75 81.46875 -74.75 Z M 81.46875 -74.75 "/></g></g></g><g fill="#ed4556" fill-opacity="1"><g transform="translate(635.726644, 497.999995)"><g><path d="M 55.984375 3.359375 C 51.878906 3.359375 47.164062 2.84375 41.84375 1.8125 C 36.53125 0.789062 31.398438 -1.117188 26.453125 -3.921875 C 21.503906 -6.722656 17.441406 -10.875 14.265625 -16.375 C 11.097656 -21.882812 9.515625 -29.117188 9.515625 -38.078125 C 9.515625 -48.148438 11.753906 -56.5 16.234375 -63.125 C 20.710938 -69.75 27.007812 -74.972656 35.125 -78.796875 C 43.25 -82.628906 52.957031 -85.335938 64.25 -86.921875 C 75.539062 -88.503906 87.90625 -89.296875 101.34375 -89.296875 L 101.34375 -101.34375 C 101.34375 -105.632812 100.6875 -109.457031 99.375 -112.8125 C 98.070312 -116.175781 95.691406 -118.835938 92.234375 -120.796875 C 88.785156 -122.753906 83.609375 -123.734375 76.703125 -123.734375 C 69.796875 -123.734375 64.382812 -122.890625 60.46875 -121.203125 C 56.550781 -119.523438 53.84375 -117.472656 52.34375 -115.046875 C 50.851562 -112.628906 50.109375 -110.113281 50.109375 -107.5 L 50.109375 -103.578125 L 17.078125 -103.578125 C 16.890625 -104.515625 16.796875 -105.445312 16.796875 -106.375 C 16.796875 -107.3125 16.796875 -108.429688 16.796875 -109.734375 C 16.796875 -118.128906 19.3125 -125.40625 24.34375 -131.5625 C 29.382812 -137.726562 36.382812 -142.441406 45.34375 -145.703125 C 54.300781 -148.972656 64.660156 -150.609375 76.421875 -150.609375 C 89.859375 -150.609375 100.914062 -148.738281 109.59375 -145 C 118.269531 -141.269531 124.753906 -135.953125 129.046875 -129.046875 C 133.335938 -122.140625 135.484375 -113.742188 135.484375 -103.859375 L 135.484375 -34.4375 C 135.484375 -30.882812 136.507812 -28.363281 138.5625 -26.875 C 140.613281 -25.382812 142.851562 -24.640625 145.28125 -24.640625 L 154.25 -24.640625 L 154.25 -1.125 C 152.382812 -0.375 149.675781 0.507812 146.125 1.53125 C 142.582031 2.5625 138.195312 3.078125 132.96875 3.078125 C 128.113281 3.078125 123.773438 2.285156 119.953125 0.703125 C 116.128906 -0.878906 112.910156 -3.164062 110.296875 -6.15625 C 107.679688 -9.144531 105.816406 -12.691406 104.703125 -16.796875 L 103.015625 -16.796875 C 99.847656 -12.878906 96.066406 -9.378906 91.671875 -6.296875 C 87.285156 -3.210938 82.15625 -0.832031 76.28125 0.84375 C 70.40625 2.519531 63.640625 3.359375 55.984375 3.359375 Z M 66.34375 -24.640625 C 71.945312 -24.640625 76.941406 -25.476562 81.328125 -27.15625 C 85.710938 -28.832031 89.347656 -31.160156 92.234375 -34.140625 C 95.128906 -37.128906 97.367188 -40.769531 98.953125 -45.0625 C 100.546875 -49.363281 101.34375 -54.03125 101.34375 -59.0625 L 101.34375 -65.78125 C 91.070312 -65.78125 81.597656 -65.125 72.921875 -63.8125 C 64.242188 -62.507812 57.335938 -60.085938 52.203125 -56.546875 C 47.078125 -53.003906 44.515625 -47.96875 44.515625 -41.4375 C 44.515625 -38.070312 45.304688 -35.128906 46.890625 -32.609375 C 48.472656 -30.085938 50.894531 -28.128906 54.15625 -26.734375 C 57.425781 -25.335938 61.488281 -24.640625 66.34375 -24.640625 Z M 66.34375 -24.640625 "/></g></g></g><g fill="#ed4556" fill-opacity="1"><g transform="translate(791.375809, 497.999995)"><g><path d="M 18.203125 0 L 18.203125 -147.25 L 46.75 -147.25 L 49.546875 -124.015625 L 51.515625 -124.015625 C 53.378906 -128.679688 55.660156 -133.019531 58.359375 -137.03125 C 61.066406 -141.039062 64.566406 -144.304688 68.859375 -146.828125 C 73.148438 -149.347656 78.378906 -150.609375 84.546875 -150.609375 C 87.523438 -150.609375 90.273438 -150.328125 92.796875 -149.765625 C 95.316406 -149.203125 97.226562 -148.644531 98.53125 -148.09375 L 98.53125 -115.890625 L 88.1875 -115.890625 C 82.394531 -115.890625 77.257812 -115.097656 72.78125 -113.515625 C 68.300781 -111.929688 64.519531 -109.457031 61.4375 -106.09375 C 58.363281 -102.738281 56.078125 -98.539062 54.578125 -93.5 C 53.085938 -88.457031 52.34375 -82.578125 52.34375 -75.859375 L 52.34375 0 Z M 18.203125 0 "/></g></g></g><g fill="#ed4556" fill-opacity="1"><g transform="translate(892.715663, 497.999995)"><g><path d="M 81.46875 3.359375 C 65.789062 3.359375 52.722656 0.609375 42.265625 -4.890625 C 31.816406 -10.398438 23.976562 -18.847656 18.75 -30.234375 C 13.53125 -41.617188 10.921875 -56.082031 10.921875 -73.625 C 10.921875 -91.351562 13.53125 -105.863281 18.75 -117.15625 C 23.976562 -128.445312 31.816406 -136.84375 42.265625 -142.34375 C 52.722656 -147.851562 65.789062 -150.609375 81.46875 -150.609375 C 95.644531 -150.609375 107.539062 -147.945312 117.15625 -142.625 C 126.769531 -137.3125 134 -129.148438 138.84375 -118.140625 C 143.695312 -107.128906 146.125 -92.847656 146.125 -75.296875 L 146.125 -65.21875 L 45.90625 -65.21875 C 46.28125 -56.082031 47.679688 -48.382812 50.109375 -42.125 C 52.535156 -35.875 56.3125 -31.207031 61.4375 -28.125 C 66.570312 -25.050781 73.335938 -23.515625 81.734375 -23.515625 C 86.035156 -23.515625 90.050781 -24.070312 93.78125 -25.1875 C 97.507812 -26.3125 100.773438 -28.039062 103.578125 -30.375 C 106.378906 -32.707031 108.570312 -35.644531 110.15625 -39.1875 C 111.738281 -42.738281 112.53125 -46.847656 112.53125 -51.515625 L 146.125 -51.515625 C 146.125 -42.179688 144.488281 -34.0625 141.21875 -27.15625 C 137.957031 -20.25 133.382812 -14.554688 127.5 -10.078125 C 121.625 -5.597656 114.765625 -2.238281 106.921875 0 C 99.085938 2.238281 90.601562 3.359375 81.46875 3.359375 Z M 46.46875 -89.296875 L 110.578125 -89.296875 C 110.578125 -95.453125 109.875 -100.675781 108.46875 -104.96875 C 107.070312 -109.269531 105.113281 -112.816406 102.59375 -115.609375 C 100.070312 -118.410156 97.039062 -120.414062 93.5 -121.625 C 89.957031 -122.84375 85.945312 -123.453125 81.46875 -123.453125 C 74.1875 -123.453125 68.070312 -122.238281 63.125 -119.8125 C 58.175781 -117.382812 54.394531 -113.648438 51.78125 -108.609375 C 49.175781 -103.578125 47.40625 -97.140625 46.46875 -89.296875 Z M 46.46875 -89.296875 "/></g></g></g><g fill="#ed4556" fill-opacity="1"><g transform="translate(1049.765578, 497.999995)"><g><path d="M 24.921875 0 L 24.921875 -29.390625 L 52.34375 -29.390625 L 52.34375 0 Z M 24.921875 0 "/></g></g></g><g fill="#ed4556" fill-opacity="1"><g transform="translate(1127.320262, 497.999995)"><g><path d="M 56.546875 3.359375 C 49.828125 3.359375 43.617188 2.5625 37.921875 0.96875 C 32.234375 -0.613281 27.289062 -3.035156 23.09375 -6.296875 C 18.894531 -9.566406 15.628906 -13.71875 13.296875 -18.75 C 10.960938 -23.789062 9.796875 -29.765625 9.796875 -36.671875 C 9.796875 -46.929688 12.40625 -55.234375 17.625 -61.578125 C 22.851562 -67.929688 30.132812 -72.832031 39.46875 -76.28125 C 48.800781 -79.738281 59.8125 -82.070312 72.5 -83.28125 C 85.195312 -84.488281 98.914062 -85.09375 113.65625 -85.09375 L 113.65625 -107.21875 C 113.65625 -113.9375 112.394531 -119.628906 109.875 -124.296875 C 107.351562 -128.960938 102.96875 -132.503906 96.71875 -134.921875 C 90.46875 -137.347656 81.835938 -138.5625 70.828125 -138.5625 C 60.367188 -138.5625 52.109375 -137.207031 46.046875 -134.5 C 39.984375 -131.800781 35.691406 -128.164062 33.171875 -123.59375 C 30.648438 -119.019531 29.390625 -113.929688 29.390625 -108.328125 L 29.390625 -103.578125 L 16.515625 -103.578125 C 16.328125 -104.515625 16.234375 -105.445312 16.234375 -106.375 C 16.234375 -107.3125 16.234375 -108.429688 16.234375 -109.734375 C 16.234375 -119.441406 18.660156 -127.28125 23.515625 -133.25 C 28.367188 -139.21875 35.226562 -143.601562 44.09375 -146.40625 C 52.957031 -149.207031 63.175781 -150.609375 74.75 -150.609375 C 85.757812 -150.609375 95.132812 -148.972656 102.875 -145.703125 C 110.625 -142.441406 116.597656 -137.773438 120.796875 -131.703125 C 124.992188 -125.640625 127.09375 -118.316406 127.09375 -109.734375 L 127.09375 -17.921875 C 127.09375 -14.367188 127.648438 -11.9375 128.765625 -10.625 C 129.890625 -9.320312 131.664062 -8.671875 134.09375 -8.671875 L 147.25 -8.671875 L 147.25 -0.84375 C 143.882812 0.65625 140.800781 1.679688 138 2.234375 C 135.207031 2.796875 132.597656 3.078125 130.171875 3.078125 C 125.128906 3.078125 121.441406 1.910156 119.109375 -0.421875 C 116.773438 -2.753906 115.28125 -5.925781 114.625 -9.9375 C 113.976562 -13.945312 113.65625 -18.285156 113.65625 -22.953125 L 111.6875 -22.953125 C 107.957031 -17.359375 103.109375 -12.597656 97.140625 -8.671875 C 91.171875 -4.753906 84.734375 -1.769531 77.828125 0.28125 C 70.921875 2.332031 63.828125 3.359375 56.546875 3.359375 Z M 57.671875 -8.671875 C 64.015625 -8.671875 70.453125 -9.742188 76.984375 -11.890625 C 83.515625 -14.035156 89.53125 -17.066406 95.03125 -20.984375 C 100.539062 -24.910156 105.019531 -29.625 108.46875 -35.125 C 111.925781 -40.632812 113.65625 -46.75 113.65625 -53.46875 L 113.65625 -72.5 C 92.9375 -72.5 76.046875 -71.425781 62.984375 -69.28125 C 49.921875 -67.132812 40.265625 -63.445312 34.015625 -58.21875 C 27.765625 -53 24.640625 -45.722656 24.640625 -36.390625 C 24.640625 -29.671875 26.128906 -24.257812 29.109375 -20.15625 C 32.097656 -16.050781 36.109375 -13.109375 41.140625 -11.328125 C 46.179688 -9.554688 51.691406 -8.671875 57.671875 -8.671875 Z M 57.671875 -8.671875 "/></g></g></g><g fill="#ed4556" fill-opacity="1"><g transform="translate(1275.970825, 497.999995)"><g><path d="M 20.4375 -181.125 L 20.4375 -202.390625 L 33.875 -202.390625 L 33.875 -181.125 Z M 20.4375 0 L 20.4375 -147.25 L 33.875 -147.25 L 33.875 0 Z M 20.4375 0 "/></g></g></g></svg>
</file>

<file path="public/logos/NagareLogoWhite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1920" zoomAndPan="magnify" viewBox="0 0 1440 809.999993" height="1080" preserveAspectRatio="xMidYMid meet" version="1.0"><defs><g/></defs><g fill="#ffffff" fill-opacity="1"><g transform="translate(109.710938, 497.999995)"><g><path d="M 21.28125 0 L 21.28125 -192.03125 L 55.984375 -192.03125 L 138.015625 -78.65625 C 138.941406 -77.539062 140.054688 -76.003906 141.359375 -74.046875 C 142.671875 -72.085938 143.882812 -70.171875 145 -68.296875 C 146.125 -66.429688 146.875 -64.941406 147.25 -63.828125 L 148.640625 -63.828125 C 148.640625 -66.441406 148.640625 -68.957031 148.640625 -71.375 C 148.640625 -73.800781 148.640625 -76.226562 148.640625 -78.65625 L 148.640625 -192.03125 L 183.640625 -192.03125 L 183.640625 0 L 149.203125 0 L 66.90625 -114.21875 C 65.414062 -116.457031 63.6875 -119.207031 61.71875 -122.46875 C 59.757812 -125.738281 58.410156 -128.023438 57.671875 -129.328125 L 56.265625 -129.328125 C 56.265625 -126.898438 56.265625 -124.425781 56.265625 -121.90625 C 56.265625 -119.394531 56.265625 -116.832031 56.265625 -114.21875 L 56.265625 0 Z M 21.28125 0 "/></g></g></g><g fill="#ffffff" fill-opacity="1"><g transform="translate(314.6303, 497.999995)"><g><path d="M 55.984375 3.359375 C 51.878906 3.359375 47.164062 2.84375 41.84375 1.8125 C 36.53125 0.789062 31.398438 -1.117188 26.453125 -3.921875 C 21.503906 -6.722656 17.441406 -10.875 14.265625 -16.375 C 11.097656 -21.882812 9.515625 -29.117188 9.515625 -38.078125 C 9.515625 -48.148438 11.753906 -56.5 16.234375 -63.125 C 20.710938 -69.75 27.007812 -74.972656 35.125 -78.796875 C 43.25 -82.628906 52.957031 -85.335938 64.25 -86.921875 C 75.539062 -88.503906 87.90625 -89.296875 101.34375 -89.296875 L 101.34375 -101.34375 C 101.34375 -105.632812 100.6875 -109.457031 99.375 -112.8125 C 98.070312 -116.175781 95.691406 -118.835938 92.234375 -120.796875 C 88.785156 -122.753906 83.609375 -123.734375 76.703125 -123.734375 C 69.796875 -123.734375 64.382812 -122.890625 60.46875 -121.203125 C 56.550781 -119.523438 53.84375 -117.472656 52.34375 -115.046875 C 50.851562 -112.628906 50.109375 -110.113281 50.109375 -107.5 L 50.109375 -103.578125 L 17.078125 -103.578125 C 16.890625 -104.515625 16.796875 -105.445312 16.796875 -106.375 C 16.796875 -107.3125 16.796875 -108.429688 16.796875 -109.734375 C 16.796875 -118.128906 19.3125 -125.40625 24.34375 -131.5625 C 29.382812 -137.726562 36.382812 -142.441406 45.34375 -145.703125 C 54.300781 -148.972656 64.660156 -150.609375 76.421875 -150.609375 C 89.859375 -150.609375 100.914062 -148.738281 109.59375 -145 C 118.269531 -141.269531 124.753906 -135.953125 129.046875 -129.046875 C 133.335938 -122.140625 135.484375 -113.742188 135.484375 -103.859375 L 135.484375 -34.4375 C 135.484375 -30.882812 136.507812 -28.363281 138.5625 -26.875 C 140.613281 -25.382812 142.851562 -24.640625 145.28125 -24.640625 L 154.25 -24.640625 L 154.25 -1.125 C 152.382812 -0.375 149.675781 0.507812 146.125 1.53125 C 142.582031 2.5625 138.195312 3.078125 132.96875 3.078125 C 128.113281 3.078125 123.773438 2.285156 119.953125 0.703125 C 116.128906 -0.878906 112.910156 -3.164062 110.296875 -6.15625 C 107.679688 -9.144531 105.816406 -12.691406 104.703125 -16.796875 L 103.015625 -16.796875 C 99.847656 -12.878906 96.066406 -9.378906 91.671875 -6.296875 C 87.285156 -3.210938 82.15625 -0.832031 76.28125 0.84375 C 70.40625 2.519531 63.640625 3.359375 55.984375 3.359375 Z M 66.34375 -24.640625 C 71.945312 -24.640625 76.941406 -25.476562 81.328125 -27.15625 C 85.710938 -28.832031 89.347656 -31.160156 92.234375 -34.140625 C 95.128906 -37.128906 97.367188 -40.769531 98.953125 -45.0625 C 100.546875 -49.363281 101.34375 -54.03125 101.34375 -59.0625 L 101.34375 -65.78125 C 91.070312 -65.78125 81.597656 -65.125 72.921875 -63.8125 C 64.242188 -62.507812 57.335938 -60.085938 52.203125 -56.546875 C 47.078125 -53.003906 44.515625 -47.96875 44.515625 -41.4375 C 44.515625 -38.070312 45.304688 -35.128906 46.890625 -32.609375 C 48.472656 -30.085938 50.894531 -28.128906 54.15625 -26.734375 C 57.425781 -25.335938 61.488281 -24.640625 66.34375 -24.640625 Z M 66.34375 -24.640625 "/></g></g></g><g fill="#ffffff" fill-opacity="1"><g transform="translate(470.279465, 497.999995)"><g><path d="M 42.546875 50.953125 C 36.015625 50.953125 29.851562 49.644531 24.0625 47.03125 C 18.28125 44.414062 13.617188 40.539062 10.078125 35.40625 C 6.535156 30.28125 4.765625 23.984375 4.765625 16.515625 C 4.765625 8.304688 7.140625 1.820312 11.890625 -2.9375 C 16.648438 -7.695312 21.925781 -11.289062 27.71875 -13.71875 C 23.425781 -15.957031 19.925781 -18.941406 17.21875 -22.671875 C 14.507812 -26.410156 13.15625 -30.890625 13.15625 -36.109375 C 13.15625 -43.203125 15.765625 -48.847656 20.984375 -53.046875 C 26.210938 -57.242188 32.1875 -60 38.90625 -61.3125 C 32 -65.601562 26.726562 -71.109375 23.09375 -77.828125 C 19.457031 -84.546875 17.640625 -92.195312 17.640625 -100.78125 C 17.640625 -111.039062 20.109375 -119.859375 25.046875 -127.234375 C 29.992188 -134.609375 37.226562 -140.347656 46.75 -144.453125 C 56.269531 -148.554688 67.75 -150.609375 81.1875 -150.609375 C 86.59375 -150.609375 91.816406 -150.234375 96.859375 -149.484375 C 101.898438 -148.734375 106.472656 -147.613281 110.578125 -146.125 C 117.109375 -150.039062 121.585938 -154.472656 124.015625 -159.421875 C 126.441406 -164.367188 127.75 -168.429688 127.9375 -171.609375 L 161.25 -171.609375 C 161.25 -165.066406 159.988281 -159.273438 157.46875 -154.234375 C 154.945312 -149.203125 151.445312 -145.050781 146.96875 -141.78125 C 142.488281 -138.519531 137.078125 -136.144531 130.734375 -134.65625 C 135.398438 -130.539062 138.941406 -125.59375 141.359375 -119.8125 C 143.785156 -114.03125 145 -107.6875 145 -100.78125 C 145 -90.507812 142.617188 -81.640625 137.859375 -74.171875 C 133.109375 -66.710938 126.113281 -60.929688 116.875 -56.828125 C 107.632812 -52.722656 96.296875 -50.671875 82.859375 -50.671875 L 60.1875 -50.671875 C 56.269531 -50.671875 53.238281 -49.828125 51.09375 -48.140625 C 48.945312 -46.460938 47.875 -44.132812 47.875 -41.15625 C 47.875 -38.726562 48.851562 -36.578125 50.8125 -34.703125 C 52.769531 -32.835938 55.519531 -31.90625 59.0625 -31.90625 L 123.453125 -31.90625 C 134.460938 -31.90625 143.5625 -28.3125 150.75 -21.125 C 157.9375 -13.945312 161.53125 -4.757812 161.53125 6.4375 C 161.53125 14.832031 159.332031 22.390625 154.9375 29.109375 C 150.550781 35.828125 144.441406 41.144531 136.609375 45.0625 C 128.773438 48.988281 119.628906 50.953125 109.171875 50.953125 Z M 54.875 26.3125 L 108.890625 26.3125 C 112.441406 26.3125 115.566406 25.703125 118.265625 24.484375 C 120.972656 23.273438 123.117188 21.550781 124.703125 19.3125 C 126.296875 17.070312 127.09375 14.550781 127.09375 11.75 C 127.09375 6.90625 125.550781 3.269531 122.46875 0.84375 C 119.394531 -1.582031 115.617188 -2.796875 111.140625 -2.796875 L 54.875 -2.796875 C 50.394531 -2.796875 46.660156 -1.445312 43.671875 1.25 C 40.679688 3.957031 39.1875 7.457031 39.1875 11.75 C 39.1875 16.050781 40.632812 19.550781 43.53125 22.25 C 46.425781 24.957031 50.207031 26.3125 54.875 26.3125 Z M 81.46875 -74.75 C 91.351562 -74.75 98.769531 -77.03125 103.71875 -81.59375 C 108.664062 -86.164062 111.140625 -92.5625 111.140625 -100.78125 C 111.140625 -108.988281 108.664062 -115.332031 103.71875 -119.8125 C 98.769531 -124.289062 91.351562 -126.53125 81.46875 -126.53125 C 71.570312 -126.53125 64.148438 -124.289062 59.203125 -119.8125 C 54.253906 -115.332031 51.78125 -108.988281 51.78125 -100.78125 C 51.78125 -95.363281 52.851562 -90.695312 55 -86.78125 C 57.15625 -82.863281 60.425781 -79.878906 64.8125 -77.828125 C 69.195312 -75.773438 74.75 -74.75 81.46875 -74.75 Z M 81.46875 -74.75 "/></g></g></g><g fill="#ffffff" fill-opacity="1"><g transform="translate(635.726644, 497.999995)"><g><path d="M 55.984375 3.359375 C 51.878906 3.359375 47.164062 2.84375 41.84375 1.8125 C 36.53125 0.789062 31.398438 -1.117188 26.453125 -3.921875 C 21.503906 -6.722656 17.441406 -10.875 14.265625 -16.375 C 11.097656 -21.882812 9.515625 -29.117188 9.515625 -38.078125 C 9.515625 -48.148438 11.753906 -56.5 16.234375 -63.125 C 20.710938 -69.75 27.007812 -74.972656 35.125 -78.796875 C 43.25 -82.628906 52.957031 -85.335938 64.25 -86.921875 C 75.539062 -88.503906 87.90625 -89.296875 101.34375 -89.296875 L 101.34375 -101.34375 C 101.34375 -105.632812 100.6875 -109.457031 99.375 -112.8125 C 98.070312 -116.175781 95.691406 -118.835938 92.234375 -120.796875 C 88.785156 -122.753906 83.609375 -123.734375 76.703125 -123.734375 C 69.796875 -123.734375 64.382812 -122.890625 60.46875 -121.203125 C 56.550781 -119.523438 53.84375 -117.472656 52.34375 -115.046875 C 50.851562 -112.628906 50.109375 -110.113281 50.109375 -107.5 L 50.109375 -103.578125 L 17.078125 -103.578125 C 16.890625 -104.515625 16.796875 -105.445312 16.796875 -106.375 C 16.796875 -107.3125 16.796875 -108.429688 16.796875 -109.734375 C 16.796875 -118.128906 19.3125 -125.40625 24.34375 -131.5625 C 29.382812 -137.726562 36.382812 -142.441406 45.34375 -145.703125 C 54.300781 -148.972656 64.660156 -150.609375 76.421875 -150.609375 C 89.859375 -150.609375 100.914062 -148.738281 109.59375 -145 C 118.269531 -141.269531 124.753906 -135.953125 129.046875 -129.046875 C 133.335938 -122.140625 135.484375 -113.742188 135.484375 -103.859375 L 135.484375 -34.4375 C 135.484375 -30.882812 136.507812 -28.363281 138.5625 -26.875 C 140.613281 -25.382812 142.851562 -24.640625 145.28125 -24.640625 L 154.25 -24.640625 L 154.25 -1.125 C 152.382812 -0.375 149.675781 0.507812 146.125 1.53125 C 142.582031 2.5625 138.195312 3.078125 132.96875 3.078125 C 128.113281 3.078125 123.773438 2.285156 119.953125 0.703125 C 116.128906 -0.878906 112.910156 -3.164062 110.296875 -6.15625 C 107.679688 -9.144531 105.816406 -12.691406 104.703125 -16.796875 L 103.015625 -16.796875 C 99.847656 -12.878906 96.066406 -9.378906 91.671875 -6.296875 C 87.285156 -3.210938 82.15625 -0.832031 76.28125 0.84375 C 70.40625 2.519531 63.640625 3.359375 55.984375 3.359375 Z M 66.34375 -24.640625 C 71.945312 -24.640625 76.941406 -25.476562 81.328125 -27.15625 C 85.710938 -28.832031 89.347656 -31.160156 92.234375 -34.140625 C 95.128906 -37.128906 97.367188 -40.769531 98.953125 -45.0625 C 100.546875 -49.363281 101.34375 -54.03125 101.34375 -59.0625 L 101.34375 -65.78125 C 91.070312 -65.78125 81.597656 -65.125 72.921875 -63.8125 C 64.242188 -62.507812 57.335938 -60.085938 52.203125 -56.546875 C 47.078125 -53.003906 44.515625 -47.96875 44.515625 -41.4375 C 44.515625 -38.070312 45.304688 -35.128906 46.890625 -32.609375 C 48.472656 -30.085938 50.894531 -28.128906 54.15625 -26.734375 C 57.425781 -25.335938 61.488281 -24.640625 66.34375 -24.640625 Z M 66.34375 -24.640625 "/></g></g></g><g fill="#ffffff" fill-opacity="1"><g transform="translate(791.375809, 497.999995)"><g><path d="M 18.203125 0 L 18.203125 -147.25 L 46.75 -147.25 L 49.546875 -124.015625 L 51.515625 -124.015625 C 53.378906 -128.679688 55.660156 -133.019531 58.359375 -137.03125 C 61.066406 -141.039062 64.566406 -144.304688 68.859375 -146.828125 C 73.148438 -149.347656 78.378906 -150.609375 84.546875 -150.609375 C 87.523438 -150.609375 90.273438 -150.328125 92.796875 -149.765625 C 95.316406 -149.203125 97.226562 -148.644531 98.53125 -148.09375 L 98.53125 -115.890625 L 88.1875 -115.890625 C 82.394531 -115.890625 77.257812 -115.097656 72.78125 -113.515625 C 68.300781 -111.929688 64.519531 -109.457031 61.4375 -106.09375 C 58.363281 -102.738281 56.078125 -98.539062 54.578125 -93.5 C 53.085938 -88.457031 52.34375 -82.578125 52.34375 -75.859375 L 52.34375 0 Z M 18.203125 0 "/></g></g></g><g fill="#ffffff" fill-opacity="1"><g transform="translate(892.715663, 497.999995)"><g><path d="M 81.46875 3.359375 C 65.789062 3.359375 52.722656 0.609375 42.265625 -4.890625 C 31.816406 -10.398438 23.976562 -18.847656 18.75 -30.234375 C 13.53125 -41.617188 10.921875 -56.082031 10.921875 -73.625 C 10.921875 -91.351562 13.53125 -105.863281 18.75 -117.15625 C 23.976562 -128.445312 31.816406 -136.84375 42.265625 -142.34375 C 52.722656 -147.851562 65.789062 -150.609375 81.46875 -150.609375 C 95.644531 -150.609375 107.539062 -147.945312 117.15625 -142.625 C 126.769531 -137.3125 134 -129.148438 138.84375 -118.140625 C 143.695312 -107.128906 146.125 -92.847656 146.125 -75.296875 L 146.125 -65.21875 L 45.90625 -65.21875 C 46.28125 -56.082031 47.679688 -48.382812 50.109375 -42.125 C 52.535156 -35.875 56.3125 -31.207031 61.4375 -28.125 C 66.570312 -25.050781 73.335938 -23.515625 81.734375 -23.515625 C 86.035156 -23.515625 90.050781 -24.070312 93.78125 -25.1875 C 97.507812 -26.3125 100.773438 -28.039062 103.578125 -30.375 C 106.378906 -32.707031 108.570312 -35.644531 110.15625 -39.1875 C 111.738281 -42.738281 112.53125 -46.847656 112.53125 -51.515625 L 146.125 -51.515625 C 146.125 -42.179688 144.488281 -34.0625 141.21875 -27.15625 C 137.957031 -20.25 133.382812 -14.554688 127.5 -10.078125 C 121.625 -5.597656 114.765625 -2.238281 106.921875 0 C 99.085938 2.238281 90.601562 3.359375 81.46875 3.359375 Z M 46.46875 -89.296875 L 110.578125 -89.296875 C 110.578125 -95.453125 109.875 -100.675781 108.46875 -104.96875 C 107.070312 -109.269531 105.113281 -112.816406 102.59375 -115.609375 C 100.070312 -118.410156 97.039062 -120.414062 93.5 -121.625 C 89.957031 -122.84375 85.945312 -123.453125 81.46875 -123.453125 C 74.1875 -123.453125 68.070312 -122.238281 63.125 -119.8125 C 58.175781 -117.382812 54.394531 -113.648438 51.78125 -108.609375 C 49.175781 -103.578125 47.40625 -97.140625 46.46875 -89.296875 Z M 46.46875 -89.296875 "/></g></g></g><g fill="#ffffff" fill-opacity="1"><g transform="translate(1049.765578, 497.999995)"><g><path d="M 24.921875 0 L 24.921875 -29.390625 L 52.34375 -29.390625 L 52.34375 0 Z M 24.921875 0 "/></g></g></g><g fill="#ffffff" fill-opacity="1"><g transform="translate(1127.320262, 497.999995)"><g><path d="M 56.546875 3.359375 C 49.828125 3.359375 43.617188 2.5625 37.921875 0.96875 C 32.234375 -0.613281 27.289062 -3.035156 23.09375 -6.296875 C 18.894531 -9.566406 15.628906 -13.71875 13.296875 -18.75 C 10.960938 -23.789062 9.796875 -29.765625 9.796875 -36.671875 C 9.796875 -46.929688 12.40625 -55.234375 17.625 -61.578125 C 22.851562 -67.929688 30.132812 -72.832031 39.46875 -76.28125 C 48.800781 -79.738281 59.8125 -82.070312 72.5 -83.28125 C 85.195312 -84.488281 98.914062 -85.09375 113.65625 -85.09375 L 113.65625 -107.21875 C 113.65625 -113.9375 112.394531 -119.628906 109.875 -124.296875 C 107.351562 -128.960938 102.96875 -132.503906 96.71875 -134.921875 C 90.46875 -137.347656 81.835938 -138.5625 70.828125 -138.5625 C 60.367188 -138.5625 52.109375 -137.207031 46.046875 -134.5 C 39.984375 -131.800781 35.691406 -128.164062 33.171875 -123.59375 C 30.648438 -119.019531 29.390625 -113.929688 29.390625 -108.328125 L 29.390625 -103.578125 L 16.515625 -103.578125 C 16.328125 -104.515625 16.234375 -105.445312 16.234375 -106.375 C 16.234375 -107.3125 16.234375 -108.429688 16.234375 -109.734375 C 16.234375 -119.441406 18.660156 -127.28125 23.515625 -133.25 C 28.367188 -139.21875 35.226562 -143.601562 44.09375 -146.40625 C 52.957031 -149.207031 63.175781 -150.609375 74.75 -150.609375 C 85.757812 -150.609375 95.132812 -148.972656 102.875 -145.703125 C 110.625 -142.441406 116.597656 -137.773438 120.796875 -131.703125 C 124.992188 -125.640625 127.09375 -118.316406 127.09375 -109.734375 L 127.09375 -17.921875 C 127.09375 -14.367188 127.648438 -11.9375 128.765625 -10.625 C 129.890625 -9.320312 131.664062 -8.671875 134.09375 -8.671875 L 147.25 -8.671875 L 147.25 -0.84375 C 143.882812 0.65625 140.800781 1.679688 138 2.234375 C 135.207031 2.796875 132.597656 3.078125 130.171875 3.078125 C 125.128906 3.078125 121.441406 1.910156 119.109375 -0.421875 C 116.773438 -2.753906 115.28125 -5.925781 114.625 -9.9375 C 113.976562 -13.945312 113.65625 -18.285156 113.65625 -22.953125 L 111.6875 -22.953125 C 107.957031 -17.359375 103.109375 -12.597656 97.140625 -8.671875 C 91.171875 -4.753906 84.734375 -1.769531 77.828125 0.28125 C 70.921875 2.332031 63.828125 3.359375 56.546875 3.359375 Z M 57.671875 -8.671875 C 64.015625 -8.671875 70.453125 -9.742188 76.984375 -11.890625 C 83.515625 -14.035156 89.53125 -17.066406 95.03125 -20.984375 C 100.539062 -24.910156 105.019531 -29.625 108.46875 -35.125 C 111.925781 -40.632812 113.65625 -46.75 113.65625 -53.46875 L 113.65625 -72.5 C 92.9375 -72.5 76.046875 -71.425781 62.984375 -69.28125 C 49.921875 -67.132812 40.265625 -63.445312 34.015625 -58.21875 C 27.765625 -53 24.640625 -45.722656 24.640625 -36.390625 C 24.640625 -29.671875 26.128906 -24.257812 29.109375 -20.15625 C 32.097656 -16.050781 36.109375 -13.109375 41.140625 -11.328125 C 46.179688 -9.554688 51.691406 -8.671875 57.671875 -8.671875 Z M 57.671875 -8.671875 "/></g></g></g><g fill="#ffffff" fill-opacity="1"><g transform="translate(1275.970825, 497.999995)"><g><path d="M 20.4375 -181.125 L 20.4375 -202.390625 L 33.875 -202.390625 L 33.875 -181.125 Z M 20.4375 0 L 20.4375 -147.25 L 33.875 -147.25 L 33.875 0 Z M 20.4375 0 "/></g></g></g></svg>
</file>

<file path="public/bg.svg">
<svg id="visual" viewBox="0 0 900 600" width="900" height="600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><rect x="0" y="0" width="900" height="600" fill="#0B181E"></rect><defs><linearGradient id="grad1_0" x1="33.3%" y1="0%" x2="100%" y2="100%"><stop offset="20%" stop-color="#0b181e" stop-opacity="1"></stop><stop offset="80%" stop-color="#0b181e" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad2_0" x1="0%" y1="0%" x2="66.7%" y2="100%"><stop offset="20%" stop-color="#0b181e" stop-opacity="1"></stop><stop offset="80%" stop-color="#0b181e" stop-opacity="1"></stop></linearGradient></defs><g transform="translate(900, 0)"><path d="M0 270.4C-26.8 260.2 -53.6 249.9 -76 234C-98.4 218 -116.4 196.4 -127.5 175.6C-138.7 154.7 -143 134.7 -167.5 121.7C-192 108.7 -236.7 102.7 -257.2 83.6C-277.7 64.5 -274.1 32.2 -270.4 0L0 0Z" fill="#ED4556"></path></g><g transform="translate(0, 600)"><path d="M0 -270.4C26.8 -266.8 53.5 -263.1 83.6 -257.2C113.6 -251.2 146.9 -243 157.5 -216.8C168.1 -190.7 156 -146.6 169.1 -122.8C182.2 -99.1 220.5 -95.6 241.6 -78.5C262.7 -61.4 266.5 -30.7 270.4 0L0 0Z" fill="#ED4556"></path></g></svg>
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/components/cade/widgets/ActionButtons.vue">
<script setup lang="ts">
/**
 * ActionButtons - Generic action button widget for user choices
 * 
 * Displays a set of buttons that the user can click to respond to the agent.
 */
import { computed } from 'vue';

interface UIAction {
  id: string;
  label: string;
  style: 'primary' | 'secondary' | 'success' | 'danger' | 'link';
  icon?: string;
  disabled?: boolean;
  next_node?: string;
}

interface Props {
  actions: UIAction[];
  data?: {
    title?: string;
    description?: string;
  };
  selectedActionId?: string | null;
  agentMessage?: string | null;
}

const props = withDefaults(defineProps<Props>(), {
  selectedActionId: null,
  agentMessage: null,
});

const emit = defineEmits<{
  (e: 'action', actionId: string): void;
}>();

// Check if any action has been selected
const hasSelection = computed(() => props.selectedActionId !== null);

const handleClick = (action: UIAction) => {
  // Don't allow clicks if already selected or button is disabled
  if (hasSelection.value || action.disabled) {
    return;
  }
  emit('action', action.id);
};

const buttonClass = (action: UIAction) => {
  const isSelected = props.selectedActionId === action.id;
  const isDisabledBySelection = hasSelection.value && !isSelected;
  
  return [
    'btn',
    `btn-${action.style}`,
    isSelected ? 'btn-selected' : '',
    isDisabledBySelection ? 'btn-not-selected' : ''
  ].filter(Boolean).join(' ');
};
</script>

<template>
  <div class="action-buttons-widget" :class="{ 'has-selection': hasSelection }">
    <div v-if="data?.title" class="widget-header">
      <h3 class="widget-title">{{ data.title }}</h3>
      <p v-if="data?.description" class="widget-description">{{ data.description }}</p>
    </div>
    
    <div class="buttons-container">
      <button
        v-for="action in actions"
        :key="action.id"
        :class="buttonClass(action)"
        :disabled="action.disabled || (hasSelection && selectedActionId !== action.id)"
        @click="handleClick(action)"
      >
        <span v-if="selectedActionId === action.id" class="btn-icon"></span>
        <span v-else-if="action.icon" class="btn-icon">{{ action.icon }}</span>
        {{ action.label }}
      </button>
    </div>
    
    <!-- Agent message integrated into widget -->
    <div v-if="agentMessage" class="agent-message">
      <p>{{ agentMessage }}</p>
    </div>
    
    <!-- Selection feedback -->
    <div v-if="hasSelection" class="selection-feedback">
      Seleccionado 
    </div>
  </div>
</template>

<style scoped>
.action-buttons-widget {
  padding: 1rem;
  background: linear-gradient(145deg, #1e1e3f 0%, #16162b 100%);
  border-radius: 16px;
  border: 1px solid rgba(99, 102, 241, 0.2);
}

.widget-header {
  margin-bottom: 1rem;
  text-align: center;
}

.widget-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #fff;
  margin: 0 0 0.5rem 0;
}

.widget-description {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
  margin: 0;
}

.buttons-container {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  justify-content: center;
}

.btn {
  padding: 0.75rem 1.5rem;
  border-radius: 12px;
  font-weight: 600;
  font-size: 0.95rem;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: white;
}

.btn-primary:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-secondary:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.15);
}

.btn-success {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
}

.btn-success:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
}

.btn-danger {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: white;
}

.btn-danger:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
}

.btn-link {
  background: transparent;
  color: #6366f1;
  text-decoration: underline;
  padding: 0.5rem 1rem;
}

.btn-link:hover:not(:disabled) {
  color: #8b5cf6;
}

.btn-icon {
  font-size: 1.1rem;
}

/* Selected state styles */
.btn-selected {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
  border-color: #10b981 !important;
  transform: scale(1.02);
  box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
}

.btn-not-selected {
  opacity: 0.4;
  transform: scale(0.95);
}

/* Keep buttons clickable but visually indicate selection was made */

.selection-feedback {
  text-align: center;
  margin-top: 0.75rem;
  font-size: 0.85rem;
  color: #10b981;
  font-weight: 500;
}

/* Agent message integrated into widget */
.agent-message {
  margin-top: 1rem;
  padding: 0.875rem 1rem;
  background: rgba(71, 85, 105, 0.4);
  border-radius: 12px;
  border-left: 3px solid #6366f1;
}

.agent-message p {
  margin: 0;
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.5;
}
</style>
</file>

<file path="src/components/cade/widgets/DeviceGrid.vue">
<script setup lang="ts">
/**
 * DeviceGrid - Premium device selection grid
 * 
 * Used in SALES scenario to show device options to customers.
 * Displays devices in a 2-column layout with pricing details.
 */
import { ref, computed } from 'vue';

interface Device {
  sku?: string;
  id?: string;
  name: string;
  brand: string;
  image_url?: string;
  // Support both naming conventions
  full_price?: number;
  price?: number;
  monthly?: number;
  price_with_plan?: number;
  storage?: string;
  color?: string;
  in_stock?: boolean;
}

interface UIAction {
  id: string;
  label: string;
  style: string;
  icon?: string;
}

interface Props {
  data: {
    devices: Device[];
    title?: string;
  };
  actions: UIAction[];
  selectedActionId?: string | null;
  agentMessage?: string | null;
}

const props = withDefaults(defineProps<Props>(), {
  selectedActionId: null,
  agentMessage: null,
});

const emit = defineEmits<{
  (e: 'action', actionId: string, device?: Device): void;
}>();

const selectedDevice = ref<Device | null>(null);

// Map device images to known brands/models
const deviceImages: Record<string, string> = {
  'iPhone 14': 'https://store.storeimages.cdn-apple.com/4668/as-images.apple.com/is/iphone-14-finish-select-202209-6-1inch-blue?wid=400&hei=400&fmt=p-jpg',
  'iPhone 15 Pro': 'https://store.storeimages.cdn-apple.com/4668/as-images.apple.com/is/iphone-15-pro-finish-select-202309-6-1inch-naturaltitanium?wid=400&hei=400&fmt=p-jpg',
  'iPhone 15': 'https://store.storeimages.cdn-apple.com/4668/as-images.apple.com/is/iphone-15-finish-select-202309-6-1inch-pink?wid=400&hei=400&fmt=p-jpg',
  'Samsung Galaxy S24': 'https://images.samsung.com/es/smartphones/galaxy-s24/images/galaxy-s24-highlights-design-back-702-mo.webp',
  'Samsung Galaxy A54': 'https://images.samsung.com/is/image/samsung/p6pim/es/sm-a546blvceub/gallery/es-galaxy-a54-5g-sm-a546-sm-a546blvceub-535227270?$684_547_PNG$',
  // Fallback
  'default': 'https://via.placeholder.com/200x200?text=Phone'
};

const getDeviceImage = (device: Device) => {
  if (device.image_url) return device.image_url;
  return deviceImages[device.name] || deviceImages['default'];
};

// Get price (support both field names)
const getFullPrice = (device: Device) => device.full_price ?? device.price ?? 0;
const getMonthlyPrice = (device: Device) => device.monthly ?? device.price_with_plan ?? null;

const selectDevice = (device: Device) => {
  if (selectedDevice.value?.name === device.name) {
    // Already selected - clicking again confirms selection
    emit('action', device.name, device);
    return;
  }
  selectedDevice.value = device;
};

const confirmSelection = () => {
  if (selectedDevice.value) {
    console.log(' DeviceGrid: Confirming device:', selectedDevice.value.name);
    emit('action', selectedDevice.value.name, selectedDevice.value);
  }
};

const handleActionClick = (action: UIAction) => {
  console.log(' DeviceGrid: Action button clicked:', action.id);
  emit('action', action.id);
};

// Computed states
const hasSelection = computed(() => selectedDevice.value !== null);
</script>

<template>
  <div class="device-grid-widget">
    <h3 v-if="data.title" class="widget-title">{{ data.title }}</h3>
    
    <div class="device-grid">
      <div 
        v-for="device in data.devices" 
        :key="device.sku || device.id || device.name"
        class="device-card"
        :class="{ 
          selected: selectedDevice?.name === device.name, 
          'out-of-stock': device.in_stock === false 
        }"
        @click="device.in_stock !== false && selectDevice(device)"
      >
        <div class="device-image">
          <img :src="getDeviceImage(device)" :alt="device.name" loading="lazy" />
        </div>
        
        <div class="device-info">
          <span class="device-brand">{{ device.brand }}</span>
          <h4 class="device-name">{{ device.name }}</h4>
          
          <div v-if="device.storage || device.color" class="device-specs">
            <span v-if="device.storage" class="spec">{{ device.storage }}</span>
            <span v-if="device.color" class="spec">{{ device.color }}</span>
          </div>
          
          <div class="device-pricing">
            <div class="price-row">
              <span class="price-label">Precio total</span>
              <span class="price-full">{{ getFullPrice(device) }}</span>
            </div>
            <div v-if="getMonthlyPrice(device)" class="price-row financing">
              <span class="price-label">O desde</span>
              <span class="price-monthly">{{ getMonthlyPrice(device).toFixed(2) }}<span class="per-month">/mes</span></span>
            </div>
            <div class="financing-note">24 meses sin intereses</div>
          </div>
        </div>
        
        <!-- Selection indicator -->
        <div v-if="selectedDevice?.name === device.name" class="selected-badge">
           Seleccionado
        </div>
        
        <div v-if="device.in_stock === false" class="out-of-stock-badge">
          Sin stock
        </div>
      </div>
    </div>
    
    <!-- Confirm button when device is selected -->
    <div v-if="hasSelection" class="selection-confirm">
      <button class="confirm-btn" @click="confirmSelection">
        Confirmar {{ selectedDevice?.name }}
      </button>
    </div>
    
    <div v-if="actions.length" class="grid-actions">
      <button
        v-for="action in actions"
        :key="action.id"
        :class="['grid-btn', `grid-btn-${action.style}`]"
        @click="handleActionClick(action)"
      >
        <span v-if="action.icon" class="btn-icon">{{ action.icon }}</span>
        {{ action.label }}
      </button>
    </div>
    
    <!-- Agent message integrated into widget -->
    <div v-if="agentMessage" class="agent-message">
      <p>{{ agentMessage }}</p>
    </div>
  </div>
</template>

<style scoped>
.device-grid-widget {
  width: 100%;
  padding: 1.5rem;
  background: linear-gradient(145deg, #1a1a35 0%, #0f0f1e 100%);
  border-radius: 20px;
  border: 1px solid rgba(99, 102, 241, 0.2);
}

.widget-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #fff;
  margin: 0 0 1.5rem 0;
  text-align: center;
  background: linear-gradient(135deg, #6366f1, #a855f7);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.device-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
}

@media (max-width: 640px) {
  .device-grid {
    grid-template-columns: 1fr;
  }
}

.device-card {
  background: linear-gradient(145deg, #252550 0%, #1a1a35 100%);
  border-radius: 20px;
  padding: 1.5rem;
  border: 2px solid rgba(99, 102, 241, 0.15);
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.device-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #6366f1, #a855f7);
  opacity: 0;
  transition: opacity 0.3s;
}

.device-card:hover {
  border-color: rgba(99, 102, 241, 0.5);
  transform: translateY(-6px);
  box-shadow: 0 20px 40px rgba(99, 102, 241, 0.15);
}

.device-card:hover::before {
  opacity: 1;
}

.device-card.selected {
  border-color: #10b981;
  box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
  background: linear-gradient(145deg, #1a3a2a 0%, #152525 100%);
}

.device-card.selected::before {
  background: linear-gradient(90deg, #10b981, #34d399);
  opacity: 1;
}

.device-card.out-of-stock {
  opacity: 0.5;
  cursor: not-allowed;
}

.device-image {
  text-align: center;
  margin-bottom: 1rem;
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.device-image img {
  max-width: 100%;
  max-height: 140px;
  object-fit: contain;
  filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
}

.device-info {
  text-align: center;
}

.device-brand {
  font-size: 0.7rem;
  color: rgba(255, 255, 255, 0.4);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 600;
}

.device-name {
  font-size: 1.25rem;
  font-weight: 700;
  color: #fff;
  margin: 0.5rem 0;
}

.device-specs {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  margin: 0.75rem 0;
  flex-wrap: wrap;
}

.spec {
  font-size: 0.7rem;
  color: rgba(255, 255, 255, 0.7);
  background: rgba(255, 255, 255, 0.08);
  padding: 0.35rem 0.75rem;
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.device-pricing {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.price-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.price-label {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.5);
}

.price-full {
  font-size: 1.4rem;
  font-weight: 700;
  color: #fff;
}

.price-row.financing {
  background: rgba(16, 185, 129, 0.1);
  margin: 0.5rem -0.75rem;
  padding: 0.5rem 0.75rem;
  border-radius: 8px;
}

.price-monthly {
  font-size: 1.2rem;
  font-weight: 700;
  color: #10b981;
}

.per-month {
  font-size: 0.75rem;
  font-weight: 400;
  opacity: 0.8;
}

.financing-note {
  font-size: 0.7rem;
  color: rgba(255, 255, 255, 0.4);
  text-align: center;
  margin-top: 0.5rem;
}

.selected-badge {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  font-size: 0.75rem;
  font-weight: 600;
  padding: 0.4rem 0.8rem;
  border-radius: 20px;
  box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
}

.out-of-stock-badge {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: linear-gradient(135deg, #ef4444, #dc2626);
  color: white;
  font-size: 0.7rem;
  font-weight: 600;
  padding: 0.35rem 0.7rem;
  border-radius: 4px;
  text-transform: uppercase;
}

.selection-confirm {
  margin-top: 1.5rem;
  text-align: center;
}

.confirm-btn {
  padding: 1rem 2.5rem;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
}

.confirm-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
}

.grid-actions {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 1.5rem;
  padding-top: 1rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.grid-btn {
  padding: 0.875rem 2rem;
  border-radius: 12px;
  font-weight: 600;
  font-size: 0.95rem;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.grid-btn-secondary {
  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.15);
}

.grid-btn-secondary:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
}

.grid-btn-primary {
  background: linear-gradient(135deg, #6366f1, #8b5cf6);
  color: white;
}

.grid-btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
}

.btn-icon {
  font-size: 1.1rem;
}

/* Agent message integrated into widget */
.agent-message {
  margin-top: 1.25rem;
  padding: 1rem 1.25rem;
  background: rgba(71, 85, 105, 0.4);
  border-radius: 12px;
  border-left: 3px solid #6366f1;
}

.agent-message p {
  margin: 0;
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.5;
}
</style>
</file>

<file path="src/components/cade/widgets/InvoiceSummary.vue">
<script setup lang="ts">
/**
 * InvoiceSummary - Displays invoice summary with details
 * 
 * Used in BILLING scenario to show invoice information.
 */
interface InvoiceData {
  invoice_id: string;
  period: string;
  total: number;
  due_date?: string;
  status?: 'paid' | 'pending' | 'overdue';
  pdf_url?: string;
  line_items?: Array<{
    description: string;
    amount: number;
  }>;
}

interface UIAction {
  id: string;
  label: string;
  style: string;
}

interface Props {
  data: InvoiceData;
  actions: UIAction[];
}

const props = defineProps<Props>();

const emit = defineEmits<{
  (e: 'action', actionId: string): void;
}>();

const statusColor = (status?: string) => {
  switch (status) {
    case 'paid': return '#10b981';
    case 'overdue': return '#ef4444';
    default: return '#f59e0b';
  }
};
</script>

<template>
  <div class="invoice-widget">
    <div class="invoice-header">
      <div class="invoice-title">
        <h3>Factura</h3>
        <span class="invoice-id">#{{ data.invoice_id }}</span>
      </div>
      <div 
        v-if="data.status" 
        class="invoice-status"
        :style="{ backgroundColor: statusColor(data.status) }"
      >
        {{ data.status === 'paid' ? 'Pagada' : data.status === 'overdue' ? 'Vencida' : 'Pendiente' }}
      </div>
    </div>
    
    <div class="invoice-body">
      <div class="invoice-period">
        <span class="label">Perodo</span>
        <span class="value">{{ data.period }}</span>
      </div>
      
      <div v-if="data.due_date" class="invoice-due">
        <span class="label">Vencimiento</span>
        <span class="value">{{ data.due_date }}</span>
      </div>
      
      <div v-if="data.line_items?.length" class="invoice-items">
        <div v-for="(item, i) in data.line_items" :key="i" class="line-item">
          <span class="item-desc">{{ item.description }}</span>
          <span class="item-amount">{{ item.amount.toFixed(2) }}</span>
        </div>
      </div>
      
      <div class="invoice-total">
        <span class="total-label">Total</span>
        <span class="total-amount">{{ data.total.toFixed(2) }}</span>
      </div>
    </div>
    
    <div class="invoice-actions">
      <button
        v-for="action in actions"
        :key="action.id"
        :class="['invoice-btn', `invoice-btn-${action.style}`]"
        @click="emit('action', action.id)"
      >
        {{ action.label }}
      </button>
    </div>
  </div>
</template>

<style scoped>
.invoice-widget {
  background: linear-gradient(145deg, #1e1e3f 0%, #16162b 100%);
  border-radius: 16px;
  padding: 1.5rem;
  border: 1px solid rgba(99, 102, 241, 0.2);
}

.invoice-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.invoice-title h3 {
  margin: 0;
  color: #fff;
  font-size: 1.25rem;
}

.invoice-id {
  color: rgba(255, 255, 255, 0.5);
  font-size: 0.875rem;
}

.invoice-status {
  padding: 0.375rem 0.75rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
  color: #fff;
  text-transform: uppercase;
}

.invoice-body {
  margin-bottom: 1.5rem;
}

.invoice-period,
.invoice-due {
  display: flex;
  justify-content: space-between;
  padding: 0.75rem 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.label {
  color: rgba(255, 255, 255, 0.6);
}

.value {
  color: #fff;
  font-weight: 500;
}

.invoice-items {
  padding: 0.75rem 0;
}

.line-item {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  font-size: 0.9rem;
}

.item-desc {
  color: rgba(255, 255, 255, 0.8);
}

.item-amount {
  color: #fff;
}

.invoice-total {
  display: flex;
  justify-content: space-between;
  padding-top: 1rem;
  border-top: 2px solid rgba(99, 102, 241, 0.3);
  margin-top: 0.5rem;
}

.total-label {
  font-size: 1.1rem;
  font-weight: 600;
  color: #fff;
}

.total-amount {
  font-size: 1.5rem;
  font-weight: 700;
  color: #6366f1;
}

.invoice-actions {
  display: flex;
  gap: 0.75rem;
}

.invoice-btn {
  flex: 1;
  padding: 0.75rem;
  border-radius: 10px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
}

.invoice-btn-primary {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: white;
}

.invoice-btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
}
</style>
</file>

<file path="src/components/cade/widgets/PlanCard.vue">
<script setup lang="ts">
/**
 * PlanCard - Displays a mobile plan card with details and pricing
 * 
 * Used in SALES scenario to show plan options to customers.
 */
import { computed } from 'vue';

interface UIAction {
  id: string;
  label: string;
  style: 'primary' | 'secondary' | 'success' | 'danger' | 'link';
  icon?: string;
  disabled?: boolean;
}

interface PlanData {
  name: string;
  price: number;
  period?: string;
  features: string[];
  data_gb?: number;
  calls_minutes?: number | string;
  sms?: number | string;
  badge?: string;
  highlighted?: boolean;
}

interface Props {
  data: PlanData;
  actions: UIAction[];
}

const props = defineProps<Props>();

const emit = defineEmits<{
  (e: 'action', actionId: string): void;
}>();

const formattedPrice = computed(() => {
  return `${props.data.price}`;
});

const period = computed(() => {
  return props.data.period || '/mes';
});
</script>

<template>
  <div class="plan-card" :class="{ highlighted: data.highlighted }">
    <!-- Badge -->
    <div v-if="data.badge" class="plan-badge">
      {{ data.badge }}
    </div>
    
    <!-- Header -->
    <div class="plan-header">
      <h3 class="plan-name">{{ data.name }}</h3>
      <div class="plan-price">
        <span class="price-amount">{{ formattedPrice }}</span>
        <span class="price-period">{{ period }}</span>
      </div>
    </div>
    
    <!-- Data/Minutes/SMS highlights -->
    <div class="plan-highlights">
      <div v-if="data.data_gb" class="highlight-item">
        <span class="highlight-value">{{ data.data_gb }}GB</span>
        <span class="highlight-label">Datos</span>
      </div>
      <div v-if="data.calls_minutes" class="highlight-item">
        <span class="highlight-value">{{ data.calls_minutes }}</span>
        <span class="highlight-label">Minutos</span>
      </div>
      <div v-if="data.sms" class="highlight-item">
        <span class="highlight-value">{{ data.sms }}</span>
        <span class="highlight-label">SMS</span>
      </div>
    </div>
    
    <!-- Features list -->
    <ul class="plan-features">
      <li v-for="(feature, index) in data.features" :key="index" class="feature-item">
        <span class="feature-check"></span>
        {{ feature }}
      </li>
    </ul>
    
    <!-- Actions -->
    <div class="plan-actions">
      <button
        v-for="action in actions"
        :key="action.id"
        :class="['plan-btn', `plan-btn-${action.style}`]"
        :disabled="action.disabled"
        @click="emit('action', action.id)"
      >
        {{ action.label }}
      </button>
    </div>
  </div>
</template>

<style scoped>
.plan-card {
  background: linear-gradient(145deg, #1e1e3f 0%, #16162b 100%);
  border-radius: 20px;
  padding: 1.5rem;
  border: 1px solid rgba(99, 102, 241, 0.2);
  position: relative;
  overflow: hidden;
}

.plan-card.highlighted {
  border-color: #6366f1;
  box-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
}

.plan-card.highlighted::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #6366f1, #8b5cf6, #a78bfa);
}

.plan-badge {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: #000;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
}

.plan-header {
  text-align: center;
  margin-bottom: 1.5rem;
}

.plan-name {
  font-size: 1.5rem;
  font-weight: 700;
  color: #fff;
  margin: 0 0 0.5rem 0;
  background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.plan-price {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 0.25rem;
}

.price-amount {
  font-size: 2.5rem;
  font-weight: 800;
  color: #fff;
}

.price-period {
  font-size: 1rem;
  color: rgba(255, 255, 255, 0.6);
}

.plan-highlights {
  display: flex;
  justify-content: center;
  gap: 1.5rem;
  margin-bottom: 1.5rem;
  padding: 1rem;
  background: rgba(99, 102, 241, 0.1);
  border-radius: 12px;
}

.highlight-item {
  text-align: center;
}

.highlight-value {
  display: block;
  font-size: 1.25rem;
  font-weight: 700;
  color: #6366f1;
}

.highlight-label {
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.6);
  text-transform: uppercase;
}

.plan-features {
  list-style: none;
  padding: 0;
  margin: 0 0 1.5rem 0;
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem 0;
  color: rgba(255, 255, 255, 0.9);
  font-size: 0.9rem;
}

.feature-check {
  color: #10b981;
  font-weight: bold;
}

.plan-actions {
  display: flex;
  gap: 0.75rem;
}

.plan-btn {
  flex: 1;
  padding: 0.875rem 1rem;
  border-radius: 12px;
  font-weight: 600;
  font-size: 0.95rem;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
}

.plan-btn-primary {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: white;
}

.plan-btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
}

.plan-btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.plan-btn-secondary:hover {
  background: rgba(255, 255, 255, 0.15);
}
</style>
</file>

<file path="src/components/cade/widgets/RouterDiagnostics.vue">
<script setup lang="ts">
/**
 * RouterDiagnostics - Displays router diagnostic information
 * 
 * Used in TECHNICAL SUPPORT scenario to show router status.
 */
interface DiagnosticData {
  model: string;
  status: 'online' | 'offline' | 'degraded';
  ip_address?: string;
  signal_strength?: number;
  last_seen?: string;
  firmware_version?: string;
  diagnostics?: Array<{
    name: string;
    status: 'ok' | 'warning' | 'error';
    value?: string;
  }>;
}

interface UIAction {
  id: string;
  label: string;
  style: string;
}

interface Props {
  data: DiagnosticData;
  actions: UIAction[];
}

const props = defineProps<Props>();

const emit = defineEmits<{
  (e: 'action', actionId: string): void;
}>();

const statusIcon = (status: string) => {
  switch (status) {
    case 'online': case 'ok': return '';
    case 'offline': case 'error': return '';
    case 'degraded': case 'warning': return '!';
    default: return '?';
  }
};

const statusColor = (status: string) => {
  switch (status) {
    case 'online': case 'ok': return '#10b981';
    case 'offline': case 'error': return '#ef4444';
    case 'degraded': case 'warning': return '#f59e0b';
    default: return '#6b7280';
  }
};
</script>

<template>
  <div class="router-widget">
    <div class="router-header">
      <div class="router-icon"></div>
      <div class="router-info">
        <h3 class="router-model">{{ data.model }}</h3>
        <div 
          class="router-status"
          :style="{ color: statusColor(data.status) }"
        >
          <span class="status-dot" :style="{ backgroundColor: statusColor(data.status) }"></span>
          {{ data.status === 'online' ? 'Conectado' : data.status === 'offline' ? 'Desconectado' : 'Degradado' }}
        </div>
      </div>
    </div>
    
    <div class="router-details">
      <div v-if="data.ip_address" class="detail-row">
        <span class="detail-label">IP</span>
        <span class="detail-value">{{ data.ip_address }}</span>
      </div>
      <div v-if="data.signal_strength !== undefined" class="detail-row">
        <span class="detail-label">Seal</span>
        <div class="signal-bar">
          <div 
            class="signal-fill" 
            :style="{ width: `${data.signal_strength}%`, backgroundColor: data.signal_strength > 60 ? '#10b981' : data.signal_strength > 30 ? '#f59e0b' : '#ef4444' }"
          ></div>
        </div>
        <span class="detail-value">{{ data.signal_strength }}%</span>
      </div>
      <div v-if="data.firmware_version" class="detail-row">
        <span class="detail-label">Firmware</span>
        <span class="detail-value">{{ data.firmware_version }}</span>
      </div>
    </div>
    
    <div v-if="data.diagnostics?.length" class="diagnostics-list">
      <h4>Diagnstico</h4>
      <div 
        v-for="(diag, i) in data.diagnostics" 
        :key="i"
        class="diagnostic-item"
      >
        <span 
          class="diag-icon"
          :style="{ backgroundColor: statusColor(diag.status) }"
        >
          {{ statusIcon(diag.status) }}
        </span>
        <span class="diag-name">{{ diag.name }}</span>
        <span v-if="diag.value" class="diag-value">{{ diag.value }}</span>
      </div>
    </div>
    
    <div class="router-actions">
      <button
        v-for="action in actions"
        :key="action.id"
        :class="['router-btn', `router-btn-${action.style}`]"
        @click="emit('action', action.id)"
      >
        {{ action.label }}
      </button>
    </div>
  </div>
</template>

<style scoped>
.router-widget {
  background: linear-gradient(145deg, #1e1e3f 0%, #16162b 100%);
  border-radius: 16px;
  padding: 1.5rem;
  border: 1px solid rgba(99, 102, 241, 0.2);
}

.router-header {
  display: flex;
  gap: 1rem;
  align-items: center;
  margin-bottom: 1.5rem;
}

.router-icon {
  font-size: 2.5rem;
}

.router-model {
  margin: 0;
  color: #fff;
  font-size: 1.25rem;
}

.router-status {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.router-details {
  margin-bottom: 1rem;
}

.detail-row {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.5rem 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.detail-label {
  color: rgba(255, 255, 255, 0.6);
  min-width: 80px;
}

.detail-value {
  color: #fff;
  margin-left: auto;
}

.signal-bar {
  flex: 1;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
}

.signal-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.3s;
}

.diagnostics-list {
  margin: 1rem 0;
}

.diagnostics-list h4 {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
  margin: 0 0 0.75rem 0;
}

.diagnostic-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem 0;
}

.diag-icon {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 0.7rem;
  font-weight: bold;
}

.diag-name {
  color: rgba(255, 255, 255, 0.9);
}

.diag-value {
  margin-left: auto;
  color: rgba(255, 255, 255, 0.6);
  font-size: 0.85rem;
}

.router-actions {
  display: flex;
  gap: 0.75rem;
  margin-top: 1rem;
}

.router-btn {
  flex: 1;
  padding: 0.75rem;
  border-radius: 10px;
  font-weight: 600;
  border: none;
  cursor: pointer;
}

.router-btn-primary {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: white;
}

.router-btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
}
</style>
</file>

<file path="src/components/cade/widgets/TroubleshootingGuide.vue">
<script setup lang="ts">
/**
 * TroubleshootingGuide - Step-by-step troubleshooting instructions
 * 
 * Used in TECHNICAL SUPPORT scenario to guide users through fixes.
 */
import { ref } from 'vue';

interface Step {
  id: string;
  title: string;
  description: string;
  image_url?: string;
}

interface GuideData {
  title: string;
  description?: string;
  steps: Step[];
  current_step?: number;
}

interface UIAction {
  id: string;
  label: string;
  style: string;
}

interface Props {
  data: GuideData;
  actions: UIAction[];
}

const props = defineProps<Props>();

const emit = defineEmits<{
  (e: 'action', actionId: string, stepId?: string): void;
}>();

const currentStep = ref(props.data.current_step || 0);

const nextStep = () => {
  if (currentStep.value < props.data.steps.length - 1) {
    currentStep.value++;
  }
};

const prevStep = () => {
  if (currentStep.value > 0) {
    currentStep.value--;
  }
};

const completeStep = () => {
  const step = props.data.steps[currentStep.value];
  emit('action', 'step_completed', step.id);
};
</script>

<template>
  <div class="guide-widget">
    <div class="guide-header">
      <h3>{{ data.title }}</h3>
      <p v-if="data.description" class="guide-desc">{{ data.description }}</p>
    </div>
    
    <!-- Progress indicator -->
    <div class="progress-bar">
      <div 
        v-for="(step, i) in data.steps" 
        :key="i"
        class="progress-step"
        :class="{ active: i === currentStep, completed: i < currentStep }"
      >
        <span class="step-number">{{ i + 1 }}</span>
      </div>
    </div>
    
    <!-- Current step -->
    <div class="current-step">
      <div class="step-header">
        <span class="step-badge">Paso {{ currentStep + 1 }} de {{ data.steps.length }}</span>
        <h4>{{ data.steps[currentStep]?.title }}</h4>
      </div>
      
      <div v-if="data.steps[currentStep]?.image_url" class="step-image">
        <img :src="data.steps[currentStep].image_url" :alt="data.steps[currentStep].title" />
      </div>
      
      <p class="step-description">{{ data.steps[currentStep]?.description }}</p>
    </div>
    
    <!-- Navigation -->
    <div class="guide-nav">
      <button 
        class="nav-btn nav-prev"
        :disabled="currentStep === 0"
        @click="prevStep"
      >
         Anterior
      </button>
      
      <button 
        v-if="currentStep < data.steps.length - 1"
        class="nav-btn nav-next"
        @click="nextStep"
      >
        Siguiente 
      </button>
      
      <button 
        v-else
        class="nav-btn nav-complete"
        @click="completeStep"
      >
         Completado
      </button>
    </div>
    
    <!-- Additional actions -->
    <div v-if="actions.length" class="guide-actions">
      <button
        v-for="action in actions"
        :key="action.id"
        :class="['guide-btn', `guide-btn-${action.style}`]"
        @click="emit('action', action.id)"
      >
        {{ action.label }}
      </button>
    </div>
  </div>
</template>

<style scoped>
.guide-widget {
  background: linear-gradient(145deg, #1e1e3f 0%, #16162b 100%);
  border-radius: 16px;
  padding: 1.5rem;
  border: 1px solid rgba(99, 102, 241, 0.2);
}

.guide-header h3 {
  margin: 0;
  color: #fff;
  font-size: 1.25rem;
}

.guide-desc {
  color: rgba(255, 255, 255, 0.6);
  margin: 0.5rem 0 0 0;
  font-size: 0.9rem;
}

.progress-bar {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  margin: 1.5rem 0;
}

.progress-step {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.progress-step.active {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  transform: scale(1.1);
}

.progress-step.completed {
  background: #10b981;
}

.step-number {
  color: #fff;
  font-weight: 600;
  font-size: 0.85rem;
}

.current-step {
  margin: 1.5rem 0;
}

.step-header {
  text-align: center;
}

.step-badge {
  font-size: 0.75rem;
  color: #6366f1;
  text-transform: uppercase;
  font-weight: 600;
}

.step-header h4 {
  margin: 0.5rem 0;
  color: #fff;
  font-size: 1.1rem;
}

.step-image {
  margin: 1rem 0;
  text-align: center;
}

.step-image img {
  max-width: 100%;
  max-height: 200px;
  border-radius: 12px;
}

.step-description {
  color: rgba(255, 255, 255, 0.8);
  line-height: 1.6;
  text-align: center;
}

.guide-nav {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 1.5rem;
}

.nav-btn {
  padding: 0.75rem 1.5rem;
  border-radius: 10px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
}

.nav-prev {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
}

.nav-prev:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.nav-next {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: white;
}

.nav-complete {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
}

.guide-actions {
  display: flex;
  justify-content: center;
  gap: 0.75rem;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.guide-btn {
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 0.85rem;
  border: none;
  cursor: pointer;
}

.guide-btn-link {
  background: transparent;
  color: #6366f1;
}
</style>
</file>

<file path="src/components/cade/widgets/WidgetRenderer.vue">
<script setup lang="ts">
/**
 * WidgetRenderer - Dispatches UI directives to appropriate widget components
 * 
 * Listens for 'livekit-ui-directive' events and renders the corresponding widget
 * based on the directive's widget type.
 */
import { ref, onMounted, onUnmounted, computed, defineAsyncComponent } from 'vue';
import { livekitService } from '@/services/livekitService';

// Props
interface Props {
  /** Current directive to render (can be passed directly or listen to events) */
  directive?: UIDirective | null;
}

interface UIDirective {
  widget: string;
  version: string;
  priority: 'primary' | 'supplementary' | 'background';
  data: Record<string, any>;
  actions: UIAction[];
  fallback_text: string;
}

interface UIAction {
  id: string;
  label: string;
  style: 'primary' | 'secondary' | 'success' | 'danger' | 'link';
  icon?: string;
  disabled?: boolean;
  next_node?: string;
}

const props = withDefaults(defineProps<Props>(), {
  directive: null,
});

// Emit events
const emit = defineEmits<{
  (e: 'action', actionId: string, actionData?: any): void;
  (e: 'dismiss'): void;
}>();

// Current active directive (from props or event)
const activeDirective = ref<UIDirective | null>(null);
// Track selected action to show which button was clicked
const selectedActionId = ref<string | null>(null);

// Widget component mapping
const widgetComponents: Record<string, any> = {
  action_buttons: defineAsyncComponent(() => import('./ActionButtons.vue')),
  plan_card: defineAsyncComponent(() => import('./PlanCard.vue')),
  device_grid: defineAsyncComponent(() => import('./DeviceGrid.vue')),
  invoice_summary: defineAsyncComponent(() => import('./InvoiceSummary.vue')),
  router_diagnostics: defineAsyncComponent(() => import('./RouterDiagnostics.vue')),
  troubleshooting_guide: defineAsyncComponent(() => import('./TroubleshootingGuide.vue')),
};

// Computed: current widget component to render
const currentWidget = computed(() => {
  const widgetType = activeDirective.value?.widget;
  if (!widgetType) return null;
  return widgetComponents[widgetType] || null;
});

// Handle widget action
const handleAction = (actionId: string, actionData?: any) => {
  console.log(' Widget action clicked:', actionId, actionData);
  
  // Mark this action as selected (for visual feedback)
  selectedActionId.value = actionId;
  
  // Send action as text message to agent (acts like user response)
  // Using a small delay to ensure the visual feedback is shown first
  // keepMicEnabled: true ensures voice conversation continues after widget click
  setTimeout(() => {
    livekitService.sendTextMessage(actionId, { keepMicEnabled: true });
  }, 100);
  
  // Emit for parent component if needed
  emit('action', actionId, actionData);
  
  // DON'T clear the directive - keep widget visible with selected state
  // The widget will be replaced when a new directive arrives
};

// Handle directive event from LiveKit
const handleDirectiveEvent = (event: CustomEvent<UIDirective>) => {
  console.log(' WidgetRenderer: Received UI directive event:', event.detail);
  console.log(' Widget type:', event.detail?.widget);
  console.log(' Current widget component:', widgetComponents[event.detail?.widget]);
  activeDirective.value = event.detail;
};

// Lifecycle
onMounted(() => {
  console.log(' WidgetRenderer: Component MOUNTED');
  // Listen for UI directive events
  window.addEventListener('livekit-ui-directive', handleDirectiveEvent as EventListener);
  
  // Use prop directive if provided
  if (props.directive) {
    activeDirective.value = props.directive;
  }
});

onUnmounted(() => {
  console.log(' WidgetRenderer: Component UNMOUNTED');
  window.removeEventListener('livekit-ui-directive', handleDirectiveEvent as EventListener);
});
</script>

<template>
  <div class="widget-renderer-wrapper">
    <!-- Debug: always visible marker -->
    <div v-if="activeDirective" class="widget-debug-info">
       Widget: {{ activeDirective?.widget }} | Has component: {{ !!currentWidget }}
    </div>
    
    <Transition name="widget-fade" mode="out-in">
      <div v-if="activeDirective && currentWidget" :key="'widget-' + activeDirective.widget" class="widget-container">
        <component 
          :is="currentWidget"
          :directive="activeDirective"
          :data="activeDirective.data"
          :actions="activeDirective.actions"
          :selectedActionId="selectedActionId"
          @action="handleAction"
        />
        
        <!-- Fallback text for screen readers / accessibility -->
        <span class="sr-only">{{ activeDirective.fallback_text }}</span>
      </div>
      
      <!-- Fallback: show fallback text if widget not supported -->
      <div v-else-if="activeDirective && !currentWidget" :key="'fallback'" class="widget-fallback">
        <p> Widget no soportado: {{ activeDirective.widget }}</p>
        <p>{{ activeDirective.fallback_text }}</p>
      </div>
    </Transition>
  </div>
</template>

<style scoped>
.widget-renderer-wrapper {
  width: 100%;
}

.widget-debug-info {
  padding: 0.5rem 1rem;
  background: rgba(255, 215, 0, 0.2);
  border: 1px solid gold;
  border-radius: 8px;
  margin-bottom: 0.5rem;
  font-size: 0.75rem;
  color: gold;
}

.widget-container {
  margin: 1rem 0;
  animation: slideUp 0.3s ease-out;
}

.widget-fallback {
  padding: 1rem;
  background: var(--color-surface, #1a1a2e);
  border-radius: 12px;
  border: 1px solid var(--color-border, #333);
  color: white;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}

/* Transition styles */
.widget-fade-enter-active,
.widget-fade-leave-active {
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.widget-fade-enter-from,
.widget-fade-leave-to {
  opacity: 0;
  transform: translateY(10px);
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>
</file>

<file path="src/components/livekit/LiveKitRoom.vue">
<script setup lang="ts">
import { ref, onMounted, onUnmounted, computed, watch } from 'vue';
import { livekitService, livekitState } from '@/services/livekitService';

const props = defineProps<{
  roomName?: string;
  participantName?: string;
  autoConnect?: boolean;
}>();

const emit = defineEmits<{
  (e: 'connected'): void;
  (e: 'disconnected'): void;
  (e: 'transcription', data: { text: string; is_final: boolean; participant: string }): void;
  (e: 'agent-message', message: string): void;
  (e: 'error', error: Error): void;
}>();

// Estado local
const isLoading = ref(false);
const errorMessage = ref<string | null>(null);

// Computed
const isConnected = computed(() => livekitState.isConnected);
const isMicEnabled = computed(() => livekitState.isMicEnabled);
const agentState = computed(() => livekitState.agentState);
const connectionState = computed(() => livekitState.connectionState);

// Estado visual del agente
const agentStateLabel = computed(() => {
  switch (livekitState.agentState) {
    case 'connecting': return 'Conectando...';
    case 'listening': return 'Escuchando';
    case 'thinking': return 'Pensando...';
    case 'speaking': return 'Hablando';
    default: return 'Desconectado';
  }
});

const agentStateColor = computed(() => {
  switch (livekitState.agentState) {
    case 'connecting': return 'bg-yellow-500';
    case 'listening': return 'bg-green-500';
    case 'thinking': return 'bg-blue-500 animate-pulse';
    case 'speaking': return 'bg-purple-500 animate-pulse';
    default: return 'bg-gray-400';
  }
});

// Handlers de eventos
const handleTranscription = (event: CustomEvent) => {
  emit('transcription', event.detail);
};

const handleAgentMessage = (event: CustomEvent) => {
  emit('agent-message', event.detail);
};

// Conectar a la sala
async function connect() {
  if (isConnected.value || isLoading.value) return;

  isLoading.value = true;
  errorMessage.value = null;

  try {
    const room = props.roomName || `room-${Date.now()}`;
    const participant = props.participantName || `user-${Math.floor(Math.random() * 1000)}`;
    
    await livekitService.connect(room, participant);
    emit('connected');
  } catch (error: any) {
    console.error('Error connecting to LiveKit:', error);
    errorMessage.value = error.message || 'Error al conectar';
    emit('error', error);
  } finally {
    isLoading.value = false;
  }
}

// Desconectar
async function disconnect() {
  await livekitService.disconnect();
  emit('disconnected');
}

// Toggle micrfono
async function toggleMic() {
  await livekitService.toggleMicrophone();
}

// Lifecycle
onMounted(() => {
  // Registrar event listeners
  window.addEventListener('livekit-transcription', handleTranscription as EventListener);
  window.addEventListener('livekit-agent-message', handleAgentMessage as EventListener);

  // Auto-conectar si est habilitado
  if (props.autoConnect) {
    connect();
  }
});

onUnmounted(() => {
  window.removeEventListener('livekit-transcription', handleTranscription as EventListener);
  window.removeEventListener('livekit-agent-message', handleAgentMessage as EventListener);
  
  // No desconectamos automticamente para permitir persistencia
});

// Exponer mtodos para uso externo
defineExpose({
  connect,
  disconnect,
  toggleMic,
  sendMessage: livekitService.sendTextMessage.bind(livekitService),
});
</script>

<template>
  <div class="livekit-room">
    <!-- Estado de conexin -->
    <div class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
      <!-- Indicador de estado -->
      <div class="flex items-center gap-2">
        <div 
          :class="[
            'w-3 h-3 rounded-full transition-colors duration-300',
            agentStateColor
          ]"
        />
        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
          {{ agentStateLabel }}
        </span>
      </div>

      <div class="flex-1" />

      <!-- Botones de control -->
      <div class="flex items-center gap-2">
        <!-- Botn de micrfono -->
        <button
          v-if="isConnected"
          @click="toggleMic"
          :class="[
            'p-2 rounded-full transition-all duration-200',
            isMicEnabled 
              ? 'bg-red-500 hover:bg-red-600 text-white' 
              : 'bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300'
          ]"
          :title="isMicEnabled ? 'Silenciar micrfono' : 'Activar micrfono'"
        >
          <!-- Mic On Icon -->
          <svg v-if="isMicEnabled" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd" />
          </svg>
          <!-- Mic Off Icon -->
          <svg v-else xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd" />
          </svg>
        </button>

        <!-- Botn de conectar/desconectar -->
        <button
          @click="isConnected ? disconnect() : connect()"
          :disabled="isLoading"
          :class="[
            'px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200',
            isConnected
              ? 'bg-red-100 hover:bg-red-200 text-red-700 dark:bg-red-900/30 dark:hover:bg-red-900/50 dark:text-red-400'
              : 'bg-green-500 hover:bg-green-600 text-white',
            isLoading && 'opacity-50 cursor-not-allowed'
          ]"
        >
          <span v-if="isLoading" class="flex items-center gap-2">
            <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Conectando...
          </span>
          <span v-else>
            {{ isConnected ? 'Desconectar' : 'Conectar' }}
          </span>
        </button>
      </div>
    </div>

    <!-- Error message -->
    <div 
      v-if="errorMessage" 
      class="mt-2 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"
    >
      <p class="text-sm text-red-700 dark:text-red-400">{{ errorMessage }}</p>
    </div>

    <!-- Slot para contenido adicional -->
    <slot 
      :is-connected="isConnected"
      :is-mic-enabled="isMicEnabled"
      :agent-state="agentState"
      :toggle-mic="toggleMic"
      :connect="connect"
      :disconnect="disconnect"
    />
  </div>
</template>

<style scoped>
.livekit-room {
  @apply w-full;
}
</style>
</file>

<file path="src/stores/costStore.ts">
import { defineStore } from "pinia";

export const useCostStore = defineStore("costStore", {
  state: () => ({
    totalCost: 0,
  }),
  actions: {
    addCost(cost) {
      if (typeof cost === 'number') {
        this.totalCost += cost;
      }
    },
    resetCost() {
      this.totalCost = 0;
    },
  },
});
</file>

<file path="src/App.vue">
<template>
  <router-view />
</template>
<script>
export default {
  name: "App",
  components: {},
};
</script>
</file>

<file path="src/index.css">
/* ./src/index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

.prose pre {
    @apply whitespace-pre-wrap break-words max-w-[20rem] overflow-auto;
  }
  .prose code {
    @apply break-words;
  }
</file>

<file path=".env.example">
# Firebase Configuration
VITE_FIREBASECONFIG_apiKey=your-firebase-api-key
VITE_FIREBASECONFIG_authDomain=your-project.firebaseapp.com

# API Backend URL
# Opciones:
# VITE_API_URL=http://localhost:8000/
# VITE_API_URL=https://agent.autoritas.ai/
# VITE_API_URL=https://autoritas-ai-server-main-magnus-process-890532438470.europe-southwest1.run.app/
VITE_API_URL=http://localhost:8000/

# LiveKit Server URL
# Local: ws://localhost:7880
# Cloud: wss://your-instance.livekit.cloud
VITE_LIVEKIT_URL=ws://localhost:7880
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
.vscode/
</file>

<file path="cors.json">
[
    {
      "origin": ["*"],
      "method": ["GET", "HEAD"],
      "maxAgeSeconds": 3600
    }
  ]
</file>

<file path="index.html">
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logos/logoSmall-White.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contextual.ai</title>
    <style>
      @font-face {
        font-family: "Archivo";
        src: url("/fonts/Archivo-Regular.ttf") format("truetype");
        font-weight: 400; /* o normal */
        font-style: normal;
      }

      @font-face {
        font-family: "Archivo";
        src: url("/fonts/Archivo-SemiBold.ttf") format("truetype");
        font-weight: 600; /* o semi-bold */
        font-style: normal;
      }

      @font-face {
        font-family: "Archivo";
        src: url("/fonts/Archivo-Thin.ttf") format("truetype");
        font-weight: 100; /* o thin */
        font-style: normal;
      }

      body {
        font-family: "Archivo", sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
</file>

<file path="LIVEKIT_CREDENTIALS.md">
# Credenciales LiveKit - Informacin para Acceso al Dashboard

## Informacin del Proyecto LiveKit

### URL del Servidor LiveKit
- **Cloud (Produccin)**: `wss://jarvis-z3jznz75.livekit.cloud`
- **Local (Desarrollo)**: `ws://localhost:7880`

### URL del Dashboard LiveKit Cloud
Para acceder al dashboard de LiveKit Cloud, visita:
- **Dashboard**: https://cloud.livekit.io
- O directamente: https://cloud.livekit.io/projects/jarvis-z3jznz75

## Credenciales Necesarias

Para acceder al dashboard de LiveKit Cloud, necesitas:

1. **API Key**: (Se encuentra en el backend o en la configuracin del servidor)
2. **API Secret**: (Se encuentra en el backend o en la configuracin del servidor)

### Dnde encontrar las credenciales?

Las credenciales (API Key y API Secret) normalmente estn en:
- El backend del proyecto (archivo `.env` del backend)
- La configuracin del servidor donde est desplegado LiveKit
- El panel de control de LiveKit Cloud (si tienes acceso)

### Configuracin Actual

Segn el cdigo:
- **URL LiveKit configurada en `.env`**: `ws://localhost:7880` (local)
- **URL LiveKit por defecto en cdigo**: `wss://jarvis-z3jznz75.livekit.cloud` (cloud)

## Notas

- El frontend NO almacena las API Key/Secret directamente
- El frontend obtiene tokens del backend a travs del endpoint `/livekit/token`
- Las credenciales de acceso al dashboard son diferentes a las que usa la aplicacin

## Pasos para Verificar

1. Accede a https://cloud.livekit.io
2. Inicia sesin con las credenciales de LiveKit Cloud
3. Selecciona el proyecto `jarvis-z3jznz75`
4. Verifica que la configuracin sea la misma que en el cdigo
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    autoprefixer: {},
    tailwindcss: {},
  },
};
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
const defaultTheme = require("tailwindcss/defaultTheme");

export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
    "./node_modules/tw-elements/dist/js/**/*.js",
  ],
  theme: {
    extend: { 
      fontFamily: {
        sans: ["Archivo", "sans-serif"],
    },
      animation: {
        typing: "blink 1s steps(5, start) infinite",
        bgmove: "move 30s linear infinite",
      },
      backgroundImage: {
        gradient: "linear-gradient(180deg,rgba(53,55,64,0),#353740 58.85%)",
      },
      keyframes: {
        blink: {
          to: { visibility: "hidden" },
        },
        move: {
          "0%": { backgroundPosition: "0% 0%" },
          "50%": { backgroundPosition: "100% 100%" },
          "100%": { backgroundPosition: "0% 0%" },
        },
      },
      colors: {
        gptlogo: "#10a37f",
        gptdarkgray: "#202123",
        gptgray: "#343541",
        gptlightgray: "#444654",
        nagare: "#341782",
        nagareBlack: "#0b181e",
        nagareGray: '#282a2c',
        nagareRed: "#ED4556",
      },
    },
  },
  plugins: [],
};
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path';

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
</file>

<file path="src/components/livekit/VoiceAssistant.vue">
<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted, nextTick } from 'vue';
import { livekitService, livekitState } from '@/services/livekitService';
import WidgetRenderer from '@/components/cade/widgets/WidgetRenderer.vue';

const props = withDefaults(defineProps<{
  roomName?: string;
  participantName?: string;
  showTranscriptions?: boolean;
  autoConnect?: boolean;
}>(), {
  showTranscriptions: true,
  autoConnect: false,
});

const emit = defineEmits<{
  (e: 'message', data: { sender: 'user' | 'agent'; text: string }): void;
}>();

// Estado local
const messages = ref<Array<{ sender: 'user' | 'agent'; text: string; timestamp: Date; segmentId?: string }>>([]);
const textInput = ref('');
const isLoading = ref(false);
const chatContainer = ref<HTMLElement | null>(null);
// Set para trackear segmentos ya procesados
const processedSegments = ref<Set<string>>(new Set());

// Computed
const isConnected = computed(() => livekitState.isConnected);
const isMicEnabled = computed(() => livekitState.isMicEnabled);
const agentState = computed(() => livekitState.agentState);

// Visualizacin del estado
const statusConfig = computed(() => {
  const configs = {
    disconnected: {
      color: 'bg-gray-400',
      ring: 'ring-gray-200',
      label: 'Desconectado',
      icon: 'offline',
    },
    connecting: {
      color: 'bg-yellow-400 animate-pulse',
      ring: 'ring-yellow-200',
      label: 'Conectando...',
      icon: 'connecting',
    },
    listening: {
      color: 'bg-green-400',
      ring: 'ring-green-200',
      label: 'Escuchando',
      icon: 'listening',
    },
    thinking: {
      color: 'bg-blue-400 animate-pulse',
      ring: 'ring-blue-200',
      label: 'Pensando...',
      icon: 'thinking',
    },
    speaking: {
      color: 'bg-purple-500 animate-pulse',
      ring: 'ring-purple-200',
      label: 'Hablando',
      icon: 'speaking',
    },
  };
  return configs[livekitState.agentState] || configs.disconnected;
});

// Handlers
const handleTranscription = (event: CustomEvent) => {
  const { text, is_final, participant, segment_id } = event.detail;
  
  if (!is_final) return; // Solo mostrar transcripciones finales
  
  // Crear una clave nica ms robusta
  const textNormalized = text.trim().toLowerCase();
  const segmentKey = segment_id 
    ? `${participant}-${segment_id}` 
    : `${participant}-${textNormalized}-${Date.now()}`;
  
  // Verificar duplicados con mltiples estrategias
  if (processedSegments.value.has(segmentKey)) {
    console.log('Mensaje duplicado ignorado (por segmentKey):', text.substring(0, 50));
    return;
  }
  
  // Tambin verificar si el mismo texto del mismo participante ya fue procesado recientemente
  const recentSameText = Array.from(processedSegments.value).some(key => 
    key.includes(participant) && key.includes(textNormalized)
  );
  
  if (recentSameText) {
    console.log('Mensaje duplicado ignorado (por texto reciente):', text.substring(0, 50));
    return;
  }
  
  processedSegments.value.add(segmentKey);
  
  const sender = participant.includes('agent') ? 'agent' : 'user';
  addMessage(sender, text, segmentKey);
};

const handleAgentMessage = (event: CustomEvent) => {
  // Para mensajes del agent, usar un ID nico basado en el contenido y timestamp
  const messageKey = `agent-msg-${Date.now()}-${event.detail}`;
  if (processedSegments.value.has(messageKey)) {
    return;
  }
  processedSegments.value.add(messageKey);
  addMessage('agent', event.detail, messageKey);
};

function addMessage(sender: 'user' | 'agent', text: string, segmentId?: string) {
  const textNormalized = text.trim();
  
  // Verificar si ya existe un mensaje idntico reciente (ltimos 10 segundos)
  const now = new Date();
  const recentDuplicate = messages.value.find(msg => 
    msg.sender === sender && 
    msg.text.trim().toLowerCase() === textNormalized.toLowerCase() && 
    (now.getTime() - msg.timestamp.getTime()) < 10000
  );
  
  if (recentDuplicate) {
    console.log('Mensaje duplicado ignorado en addMessage:', textNormalized.substring(0, 50));
    return; // Ignorar duplicado reciente
  }
  
  console.log('Agregando mensaje:', sender, textNormalized.substring(0, 50), segmentId);
  
  messages.value.push({
    sender,
    text: textNormalized,
    timestamp: new Date(),
    segmentId,
  });
  emit('message', { sender, text: textNormalized });
  scrollToBottom();
}

function scrollToBottom() {
  nextTick(() => {
    if (chatContainer.value) {
      chatContainer.value.scrollTop = chatContainer.value.scrollHeight;
    }
  });
}

// Acciones
async function connect(enableMic: boolean = true) {
  if (isConnected.value || isLoading.value) return;
  
  isLoading.value = true;
  // Limpiar mensajes y segmentos procesados al reconectar
  messages.value = [];
  processedSegments.value.clear();
  
  try {
    const room = props.roomName || `voice-room-${Date.now()}`;
    const participant = props.participantName || `user-${Math.floor(Math.random() * 1000)}`;
    await livekitService.connect(room, participant);
    
    // Solo activar micrfono si se solicita explcitamente (para voz, no para texto)
    if (enableMic) {
      await new Promise(resolve => setTimeout(resolve, 500));
      if (!livekitState.isMicEnabled) {
        await livekitService.enableMicrophone();
      }
    }
  } catch (error) {
    console.error('Error connecting:', error);
  } finally {
    isLoading.value = false;
  }
}

async function disconnect() {
  await livekitService.disconnect();
}

async function toggleMic() {
  if (!isConnected.value) {
    await connect();
    // Esperar un poco antes de activar el mic
    await new Promise(resolve => setTimeout(resolve, 500));
  }
  await livekitService.toggleMicrophone();
}

async function sendText() {
  if (!textInput.value.trim()) return;
  
  const text = textInput.value.trim();
  
  // Auto-conectar si no est conectado (SIN activar micrfono)
  if (!isConnected.value) {
    try {
      await connect(false); // false = no activar micrfono
      // Esperar un poco para que la conexin se establezca
      await new Promise(resolve => setTimeout(resolve, 1000));
    } catch (error) {
      console.error('Error auto-conectando:', error);
      return;
    }
  }
  
  // Asegurarse de que el micrfono NO est activado cuando se enva texto
  if (livekitState.isMicEnabled) {
    await livekitService.disableMicrophone();
  }
  
  addMessage('user', text);
  
  try {
    await livekitService.sendTextMessage(text);
  } catch (error) {
    console.error('Error enviando mensaje:', error);
  }
  
  textInput.value = '';
}

// Lifecycle
onMounted(() => {
  window.addEventListener('livekit-transcription', handleTranscription as EventListener);
  window.addEventListener('livekit-agent-message', handleAgentMessage as EventListener);
  
  if (props.autoConnect) {
    connect();
  }
});

onUnmounted(() => {
  window.removeEventListener('livekit-transcription', handleTranscription as EventListener);
  window.removeEventListener('livekit-agent-message', handleAgentMessage as EventListener);
});

defineExpose({
  connect,
  disconnect,
  toggleMic,
  sendText,
});
</script>

<template>
  <div class="voice-assistant flex flex-col h-full bg-white dark:bg-gray-900 rounded-2xl shadow-xl overflow-hidden">
    <!-- Header -->
    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-100 dark:border-gray-800">
      <div class="flex items-center gap-3">
        <!-- Avatar del agente con indicador de estado -->
        <div class="relative">
          <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
          </div>
          <!-- Indicador de estado -->
          <div 
            :class="[
              'absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full border-2 border-white dark:border-gray-900',
              statusConfig.color
            ]"
          />
        </div>
        <div>
          <h3 class="font-semibold text-gray-900 dark:text-white">Asistente de Voz</h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">{{ statusConfig.label }}</p>
        </div>
      </div>

      <!-- Botn de conexin -->
      <button
        @click="isConnected ? disconnect() : connect()"
        :disabled="isLoading"
        :class="[
          'px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200',
          isConnected
            ? 'bg-red-50 hover:bg-red-100 text-red-600 dark:bg-red-900/20 dark:hover:bg-red-900/30 dark:text-red-400'
            : 'bg-indigo-500 hover:bg-indigo-600 text-white',
        ]"
      >
        {{ isConnected ? 'Desconectar' : 'Conectar' }}
      </button>
    </div>

    <!-- Chat area -->
    <div 
      ref="chatContainer"
      class="flex-1 overflow-y-auto p-4 space-y-4"
      v-if="showTranscriptions"
    >
      <!-- Empty state -->
      <div 
        v-if="messages.length === 0" 
        class="flex flex-col items-center justify-center h-full text-center"
      >
        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-100 to-purple-100 dark:from-indigo-900/30 dark:to-purple-900/30 flex items-center justify-center mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
          </svg>
        </div>
        <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
          Asistente de Voz LiveKit
        </h4>
        <p class="text-gray-500 dark:text-gray-400 max-w-sm">
          Conecta y mantn presionado el botn del micrfono para hablar con el asistente.
        </p>
      </div>

      <!-- Messages -->
      <div 
        v-for="(msg, index) in messages" 
        :key="msg.segmentId || `msg-${index}-${msg.timestamp.getTime()}`"
        :class="[
          'flex',
          msg.sender === 'user' ? 'justify-end' : 'justify-start'
        ]"
      >
        <div 
          :class="[
            'max-w-[80%] px-4 py-3 rounded-2xl',
            msg.sender === 'user'
              ? 'bg-indigo-500 text-white rounded-br-md'
              : 'bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white rounded-bl-md'
          ]"
        >
          <p class="text-sm leading-relaxed">{{ msg.text }}</p>
          <p 
            :class="[
              'text-xs mt-1 opacity-70',
              msg.sender === 'user' ? 'text-indigo-100' : 'text-gray-500 dark:text-gray-400'
            ]"
          >
            {{ msg.timestamp.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }) }}
          </p>
        </div>
      </div>
      
      <!-- UI Widget Renderer - displays rich widgets from CADE -->
      <WidgetRenderer />
    </div>

    <!-- rea de visualizacin cuando no hay transcripciones -->
    <div 
      v-else 
      class="flex-1 flex items-center justify-center"
    >
      <!-- Visualizador de audio animado -->
      <div class="flex items-center gap-1">
        <div 
          v-for="i in 5" 
          :key="i"
          :class="[
            'w-1 bg-indigo-500 rounded-full transition-all duration-150',
            agentState === 'speaking' ? 'animate-pulse' : '',
          ]"
          :style="{
            height: agentState === 'speaking' 
              ? `${20 + Math.random() * 30}px` 
              : '8px',
            animationDelay: `${i * 100}ms`
          }"
        />
      </div>
    </div>

    <!-- Input area -->
    <div class="p-4 border-t border-gray-100 dark:border-gray-800">
      <!-- Botn de micrfono grande -->
      <div class="flex items-center justify-center mb-4">
        <button
          @click="toggleMic"
          :disabled="!isConnected && !isLoading"
          :class="[
            'relative w-16 h-16 rounded-full transition-all duration-300 transform',
            isMicEnabled
              ? 'bg-red-500 hover:bg-red-600 scale-110 shadow-lg shadow-red-500/30'
              : isConnected
                ? 'bg-indigo-500 hover:bg-indigo-600 shadow-lg shadow-indigo-500/30'
                : 'bg-gray-300 dark:bg-gray-700 cursor-not-allowed',
          ]"
        >
          <!-- Ripple effect when speaking -->
          <div 
            v-if="isMicEnabled"
            class="absolute inset-0 rounded-full bg-red-400 animate-ping opacity-20"
          />
          
          <!-- Mic icon -->
          <svg 
            v-if="!isMicEnabled"
            xmlns="http://www.w3.org/2000/svg" 
            class="h-8 w-8 text-white mx-auto" 
            fill="none" 
            viewBox="0 0 24 24" 
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
          </svg>
          
          <!-- Stop icon when recording -->
          <svg 
            v-else
            xmlns="http://www.w3.org/2000/svg" 
            class="h-8 w-8 text-white mx-auto" 
            fill="none" 
            viewBox="0 0 24 24" 
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
          </svg>
        </button>
      </div>

      <!-- Text input -->
      <form @submit.prevent="sendText" class="flex gap-2">
        <input
          v-model="textInput"
          type="text"
          placeholder="O escribe un mensaje..."
          class="flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-800 rounded-xl text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"
        />
        <button
          type="submit"
          :disabled="!textInput.trim()"
          class="px-4 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
          </svg>
        </button>
      </form>

      <!-- Hint text -->
      <p class="text-xs text-center text-gray-400 mt-3">
        {{ isConnected 
          ? (isMicEnabled ? 'Hablando... Pulsa para detener' : 'Pulsa el micrfono para hablar')
          : 'Conecta para comenzar'
        }}
      </p>
    </div>
  </div>
</template>

<style scoped>
.voice-assistant {
  min-height: 500px;
}

@keyframes pulse-ring {
  0% {
    transform: scale(1);
    opacity: 0.3;
  }
  100% {
    transform: scale(1.5);
    opacity: 0;
  }
}
</style>
</file>

<file path="src/stores/userStore.ts">
// stores/userStore.ts
import { defineStore } from "pinia";
import { useChatStore } from './chatStore';
import { useCostStore } from './costStore';

export const useUserStore = defineStore("userStore", {
  state: () => ({
    userImage: "/default.png",
    userName: "",
    isAuthenticated: false,
    token: "",
    auth_claims: "",
  }),
  actions: {
    setUserImage(imageUrl: string) {
      this.userImage = imageUrl || "/default.png";
    },
    setUserName(name: string) {
      this.userName = name;
    },
    login() {
      this.isAuthenticated = true;
    },
    logout() {
      this.userImage = "/default.png";
      this.userName = "";
      this.token = "";
      this.isAuthenticated = false;
      const chatStore = useChatStore();
      chatStore.session_id = null
      const costStore = useCostStore();
      costStore.resetCost();
    },
    setToken(token: string) {
      this.token = token;
    },
  },
  persist: true,
});
</file>

<file path="src/views/LiveKitChatView.vue">
<script setup lang="ts">
import { ref, onMounted, onUnmounted, nextTick, computed, defineAsyncComponent } from 'vue';
import { livekitService, livekitState } from '@/services/livekitService';
import VoiceAssistant from '@/components/livekit/VoiceAssistant.vue';

// Lazy load widget components
const widgetComponents: Record<string, any> = {
  action_buttons: defineAsyncComponent(() => import('@/components/cade/widgets/ActionButtons.vue')),
  device_grid: defineAsyncComponent(() => import('@/components/cade/widgets/DeviceGrid.vue')),
  plan_card: defineAsyncComponent(() => import('@/components/cade/widgets/PlanCard.vue')),
  invoice_summary: defineAsyncComponent(() => import('@/components/cade/widgets/InvoiceSummary.vue')),
};

// Message types
interface TextMessage {
  type: 'text';
  sender: 'user' | 'agent';
  text: string;
  timestamp: Date;
}

interface WidgetMessage {
  type: 'widget';
  widget: string;
  data: Record<string, any>;
  actions: any[];
  timestamp: Date;
  selectedActionId?: string | null;
  agentMessage?: string | null; // The agent's message to display within the widget
}

type ChatMessage = TextMessage | WidgetMessage;

// Props opcionales para configuracin
const props = withDefaults(defineProps<{
  agentId?: string;
}>(), {
  agentId: 'voice_agent',
});

// Estado local
const messages = ref<ChatMessage[]>([]);
const textInput = ref('');
const chatContainer = ref<HTMLElement | null>(null);
const voiceAssistantRef = ref<InstanceType<typeof VoiceAssistant> | null>(null);

// Computed
const isConnected = computed(() => livekitState.isConnected);
const agentState = computed(() => livekitState.agentState);

// Get widget component for a widget type
function getWidgetComponent(widgetType: string) {
  return widgetComponents[widgetType] || null;
}

// Handle widget action from embedded widget
function handleWidgetAction(messageIndex: number, actionId: string, actionData?: any) {
  console.log(' Widget action in chat:', actionId, actionData);
  
  // Mark this widget as having a selection
  const msg = messages.value[messageIndex];
  if (msg.type === 'widget') {
    msg.selectedActionId = actionId;
  }
  
  // Send the action as text to the agent
  livekitService.sendTextMessage(actionId, { keepMicEnabled: true });
  
  scrollToBottom();
}

// Handlers
function handleMessage(data: { sender: 'user' | 'agent'; text: string }) {
  messages.value.push({
    type: 'text',
    ...data,
    timestamp: new Date(),
  });
  scrollToBottom();
}

// Handle UI directive events - add widget as a message
// If the previous message was from the agent, merge it into the widget
function handleUIDirective(event: CustomEvent) {
  const directive = event.detail;
  console.log(' Adding widget to chat history:', directive.widget);
  
  // Check if the last message was from the agent - if so, merge it into the widget
  let agentMessage: string | null = null;
  const lastMsg = messages.value[messages.value.length - 1];
  if (lastMsg && lastMsg.type === 'text' && lastMsg.sender === 'agent') {
    // Remove the last agent message - we'll include it in the widget
    agentMessage = lastMsg.text;
    messages.value.pop();
  }
  
  messages.value.push({
    type: 'widget',
    widget: directive.widget,
    data: directive.data,
    actions: directive.actions || [],
    timestamp: new Date(),
    selectedActionId: null,
    agentMessage: agentMessage, // Include the agent's message in the widget
  });
  scrollToBottom();
}

function scrollToBottom() {
  nextTick(() => {
    if (chatContainer.value) {
      chatContainer.value.scrollTop = chatContainer.value.scrollHeight;
    }
  });
}

// Enviar mensaje de texto
async function sendTextMessage() {
  if (!textInput.value.trim()) return;
  
  const text = textInput.value.trim();
  
  // Auto-conectar si no est conectado (SIN activar micrfono)
  if (!isConnected.value) {
    try {
      // Conectar automticamente usando livekitService directamente
      const roomName = `voice-room-${Date.now()}`;
      const participantName = `user-${Math.floor(Math.random() * 1000)}`;
      await livekitService.connect(roomName, participantName);
      // Esperar un poco para que la conexin se establezca
      await new Promise(resolve => setTimeout(resolve, 1000));
    } catch (error) {
      console.error('Error auto-conectando:', error);
      return;
    }
  }
  
  // Asegurarse de que el micrfono NO est activado cuando se enva texto
  if (livekitState.isMicEnabled) {
    await livekitService.disableMicrophone();
  }
  
  // Agregar mensaje del usuario
  messages.value.push({
    type: 'text',
    sender: 'user',
    text,
    timestamp: new Date(),
  });
  
  // Enviar al agente
  try {
    await livekitService.sendTextMessage(text);
  } catch (error) {
    console.error('Error enviando mensaje:', error);
  }
  
  textInput.value = '';
  scrollToBottom();
}

// Lifecycle - listen for UI directive events
onMounted(() => {
  window.addEventListener('livekit-ui-directive', handleUIDirective as EventListener);
});

onUnmounted(() => {
  window.removeEventListener('livekit-ui-directive', handleUIDirective as EventListener);
});
</script>

<template>
  <div class="flex flex-col h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
    <!-- Header -->
    <header class="flex items-center justify-between px-6 py-4 bg-slate-800/50 backdrop-blur-sm border-b border-slate-700/50">
      <div class="flex items-center gap-4">
        <div class="relative">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center shadow-lg shadow-violet-500/20">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
          </div>
          <!-- Status indicator -->
          <div 
            :class="[
              'absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-slate-800',
              isConnected ? 'bg-emerald-400' : 'bg-slate-500'
            ]"
          />
        </div>
        <div>
          <h1 class="text-lg font-semibold text-white">LiveKit Voice Agent</h1>
          <p class="text-xs text-slate-400">
            {{ isConnected ? 'Conectado' : 'Desconectado' }}
            <span v-if="isConnected" class="text-violet-400">  {{ agentState }}</span>
          </p>
        </div>
      </div>

      <!-- Connection status badge -->
      <div 
        :class="[
          'px-3 py-1.5 rounded-full text-xs font-medium',
          isConnected 
            ? 'bg-emerald-500/10 text-emerald-400 ring-1 ring-emerald-500/20' 
            : 'bg-slate-700/50 text-slate-400 ring-1 ring-slate-600/50'
        ]"
      >
        <span class="flex items-center gap-1.5">
          <span 
            :class="[
              'w-1.5 h-1.5 rounded-full',
              isConnected ? 'bg-emerald-400 animate-pulse' : 'bg-slate-500'
            ]"
          />
          {{ isConnected ? 'En lnea' : 'Fuera de lnea' }}
        </span>
      </div>
    </header>

    <!-- Main content -->
    <div class="flex-1 flex overflow-hidden">
      <!-- Chat area -->
      <div class="flex-1 flex flex-col">
        <!-- Messages -->
        <div 
          ref="chatContainer"
          class="flex-1 overflow-y-auto p-6 space-y-4"
        >
          <!-- Empty state -->
          <div 
            v-if="messages.length === 0" 
            class="flex flex-col items-center justify-center h-full text-center"
          >
            <div class="w-24 h-24 rounded-2xl bg-gradient-to-br from-violet-500/20 to-fuchsia-500/20 flex items-center justify-center mb-6 ring-1 ring-violet-500/30">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-violet-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
              </svg>
            </div>
            <h2 class="text-xl font-semibold text-white mb-2">Bienvenido al Asistente de Voz</h2>
            <p class="text-slate-400 max-w-md mb-6">
              Conecta con el agente de voz LiveKit para comenzar una conversacin en tiempo real.
            </p>
            <button
              v-if="!isConnected"
              @click="voiceAssistantRef?.connect()"
              class="px-6 py-3 bg-gradient-to-r from-violet-500 to-fuchsia-500 hover:from-violet-600 hover:to-fuchsia-600 text-white font-medium rounded-xl transition-all duration-200 shadow-lg shadow-violet-500/25 hover:shadow-violet-500/40"
            >
              Conectar ahora
            </button>
          </div>

          <!-- Messages and Widgets list -->
          <template v-for="(msg, index) in messages" :key="index">
            <!-- Text message -->
            <div 
              v-if="msg.type === 'text'"
              :class="[
                'flex',
                msg.sender === 'user' ? 'justify-end' : 'justify-start'
              ]"
            >
              <div 
                :class="[
                  'max-w-[70%] px-4 py-3 rounded-2xl',
                  msg.sender === 'user'
                    ? 'bg-gradient-to-br from-violet-500 to-fuchsia-500 text-white rounded-br-md'
                    : 'bg-slate-700/50 text-slate-100 rounded-bl-md ring-1 ring-slate-600/50'
                ]"
              >
                <p class="text-sm leading-relaxed">{{ msg.text }}</p>
                <p 
                  :class="[
                    'text-xs mt-1.5',
                    msg.sender === 'user' ? 'text-violet-200/70' : 'text-slate-500'
                  ]"
                >
                  {{ msg.timestamp.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }) }}
                </p>
              </div>
            </div>
            
            <!-- Widget message -->
            <div 
              v-else-if="msg.type === 'widget' && getWidgetComponent(msg.widget)"
              class="widget-message-container"
            >
              <component 
                :is="getWidgetComponent(msg.widget)"
                :data="msg.data"
                :actions="msg.actions"
                :selectedActionId="msg.selectedActionId"
                :agentMessage="msg.agentMessage"
                @action="(actionId: string, actionData?: any) => handleWidgetAction(index, actionId, actionData)"
              />
            </div>
          </template>

          <!-- Agent typing indicator -->
          <div 
            v-if="agentState === 'thinking'"
            class="flex justify-start"
          >
            <div class="bg-slate-700/50 px-4 py-3 rounded-2xl rounded-bl-md ring-1 ring-slate-600/50">
              <div class="flex items-center gap-1">
                <span class="w-2 h-2 bg-violet-400 rounded-full animate-bounce" style="animation-delay: 0ms"></span>
                <span class="w-2 h-2 bg-violet-400 rounded-full animate-bounce" style="animation-delay: 150ms"></span>
                <span class="w-2 h-2 bg-violet-400 rounded-full animate-bounce" style="animation-delay: 300ms"></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Input area -->
        <div class="p-4 bg-slate-800/30 border-t border-slate-700/50">
          <form @submit.prevent="sendTextMessage" class="flex items-center gap-3">
            <!-- Mic button -->
            <button
              type="button"
              @click="livekitService.toggleMicrophone()"
              :disabled="!isConnected"
              :class="[
                'relative w-12 h-12 rounded-xl transition-all duration-200 flex items-center justify-center',
                livekitState.isMicEnabled
                  ? 'bg-red-500 hover:bg-red-600 text-white shadow-lg shadow-red-500/30'
                  : isConnected
                    ? 'bg-slate-700 hover:bg-slate-600 text-slate-300'
                    : 'bg-slate-800 text-slate-600 cursor-not-allowed'
              ]"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
              </svg>
              <!-- Recording indicator -->
              <div 
                v-if="livekitState.isMicEnabled"
                class="absolute inset-0 rounded-xl bg-red-400 animate-ping opacity-30"
              />
            </button>

            <!-- Text input -->
            <input
              v-model="textInput"
              type="text"
              placeholder="Escribe un mensaje o usa el micrfono..."
              class="flex-1 px-4 py-3 bg-slate-700/50 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500/50 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
            />

            <!-- Send button -->
            <button
              type="submit"
              :disabled="!textInput.trim()"
              class="w-12 h-12 rounded-xl bg-gradient-to-r from-violet-500 to-fuchsia-500 hover:from-violet-600 hover:to-fuchsia-600 text-white flex items-center justify-center transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-violet-500/20"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
              </svg>
            </button>
          </form>

          <!-- Status hint -->
          <p class="text-xs text-center text-slate-500 mt-3">
            {{ isConnected 
              ? (livekitState.isMicEnabled ? ' Grabando... pulsa para detener' : 'Pulsa el micrfono para hablar o escribe un mensaje')
              : 'Conecta para comenzar la conversacin'
            }}
          </p>
        </div>
      </div>

      <!-- Sidebar with VoiceAssistant component (optional, can be hidden) -->
      <div class="hidden lg:block w-80 border-l border-slate-700/50 bg-slate-800/30">
        <VoiceAssistant
          ref="voiceAssistantRef"
          :show-transcriptions="false"
          @message="handleMessage"
          class="h-full"
        />
      </div>
    </div>
  </div>
</template>

<style scoped>
/* Custom scrollbar */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(148, 163, 184, 0.2);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(148, 163, 184, 0.3);
}

/* Widget message containers */
.widget-message-container {
  width: 100%;
  margin: 1rem 0;
}
</style>
</file>

<file path="src/views/Login.vue">
<template>
  <div
    class="absolute inset-0 -z-10 bg-cover bg-center animate-bgmove"
    style="background-image: url('/background.png')"
  ></div>
  <div class="relative w-full h-screen overflow-hidden">
    <div class="absolute inset-0 flex flex-col justify-center items-center">
      <div class="max-w-md p-8 text-center flex flex-col items-center">
        <!-- <h1 class="text-gray-900 text-8xl">Nagare.ai</h1> -->
        <img src="/logos/contextualLogo.png" class="w-80 h-auto" />
        <h1 class="mt-5 text-white text-4xl sancoale-font">
          Talk with your data
        </h1>
        <button
          @click="signInWithGoogle"
          class="h-12 w-48 p-2 mt-12 bg-nagareRed rounded-lg shadow-lg flex items-center justify-center rounded-md border border-gray-300 text-sm font-medium shadow-sm text-gray-900 hover:text-nagareBlack focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
        >
          <div class="bg-white py-1.5 px-1.5 rounded-full">
            <img v-if="!waitingGoogle" src="/google.png" class="w-5 h-5" />
            <img
              v-else
              src="/google.png"
              class="w-5 h-5 animate-spin duration-300"
            />
          </div>
          <span class="py-1.5 ml-2 text-white">Sign in with Google</span>
        </button>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from "vue";
import {
  GoogleAuthProvider,
  signInWithPopup,
  browserLocalPersistence,
  setPersistence,
  getAuth,
} from "firebase/auth";
import { useUserStore } from "@/stores/userStore";
import router from "@/router/index";

const userStore = useUserStore();

const waitingGoogle = ref(false);

async function signInWithGoogle() {
  const provider = new GoogleAuthProvider();
  const auth = getAuth();
  auth.useDeviceLanguage();

  try {
    await setPersistence(auth, browserLocalPersistence);
    waitingGoogle.value = true;
    const data = await signInWithPopup(auth, provider);

    console.log("DATA", data);

    if (!data || !data.user) {
      throw new Error("No user data returned from sign-in.");
    }

    const photoURL = data.user.photoURL;
    if (photoURL) {
      userStore.setUserImage(photoURL);
    }
    if (data.user.displayName) {
      userStore.setUserName(data.user.displayName);
    }

    const token = await data.user.getIdToken();
    if (token) {
      userStore.token = token;
    }

    userStore.auth_claims = data.user.uid;

    console.log("UID", userStore.auth_claims);

    userStore.login();
    router.push("/home");
  } catch (error: any) {
    console.error("Sign-in error:", error);
    waitingGoogle.value = false;
    alert("Failed to sign in with Google. Please try again.");
  }
}
</script>

<style scoped>
.animate-bgmove {
  animation: bgmove 10s linear infinite;
}

@keyframes bgmove {
  0% {
    background-position: 0% 0%;
  }
  50% {
    background-position: 100% 0%;
  }
  100% {
    background-position: 0% 0%;
  }
}

@font-face {
  font-family: "Sancoale";
  src: url("/fonts/Sancoale-Regular.ttf") format("truetype");
  font-weight: normal;
  font-style: normal;
}

.sancoale-font {
  font-family: "Sancoale", sans-serif;
}
</style>
</file>

<file path="src/main.js">
import { createApp } from "vue";
import { createPinia } from "pinia";
import { initializeApp } from "firebase/app"; // Versin modular
import { getAuth, onAuthStateChanged } from "firebase/auth"; // Versin modular
import piniaPluginPersistedstate from "pinia-plugin-persistedstate";

import App from "./App.vue";
import router from "./router";
import { useUserStore } from "./stores/userStore";
import "./index.css";

const env = import.meta.env;

// Configuracin de Firebase
const FIREBASECONFIG = {
  apiKey: env.VITE_FIREBASECONFIG_apiKey,
  authDomain: env.VITE_FIREBASECONFIG_authDomain,
};

// 1. Inicializar Firebase
const firebaseApp = initializeApp(FIREBASECONFIG);
const auth = getAuth(firebaseApp);

const app = createApp(App);
const pinia = createPinia();

// 2. Configurar Pinia con persistencia
pinia.use(piniaPluginPersistedstate);

// 3. ORDEN CRTICO: Registrar Pinia ANTES que el Router
app.use(pinia); 
app.use(router);

// 4. Sincronizar estado de Firebase con Pinia
const userStore = useUserStore(pinia); // Pasamos pinia para asegurar acceso inmediato

onAuthStateChanged(auth, async (user) => {
  if (user) {
    // Si hay usuario real en Firebase, actualizamos/confirmamos el store
    userStore.isAuthenticated = true;
    userStore.setUserName(user.displayName || "");
    userStore.setUserImage(user.photoURL || "/default.png");
    
    // Obtenemos el token actualizado
    const token = await user.getIdToken();
    userStore.setToken(token);
  } else {
    // Si Firebase dice que NO hay sesin, forzamos el logout.
    // Esto evita que entres a /home si tenas un "true" viejo en LocalStorage.
    userStore.logout();
  }
});

app.mount("#app");
</file>

<file path="README.md">
# Documentacin Frontend - LiveKit Integration

## Descripcin General

Integracin de LiveKit para comunicacin en tiempo real con agentes de voz e IA. Soporta modos de audio (STT/TTS) y texto (solo LLM) con deteccin automtica.

## Instalacin y Configuracin

### Requisitos Previos

- Node.js >= 18.x
- npm >= 9.x o yarn
- Backend corriendo y accesible
- Servidor LiveKit corriendo (local o remoto)

### Instalacin

1. Clonar el repositorio (si aplica) o navegar al directorio del proyecto:
```bash
cd chat-sales-agent-front
```

2. Instalar dependencias:
```bash
npm install
```

### Configuracin de Variables de Entorno

1. Copiar el archivo de ejemplo:
```bash
cp .env.example .env
```

2. Editar `.env` con tus valores:
```env
# Firebase Configuration
VITE_FIREBASECONFIG_apiKey=tu-api-key-de-firebase
VITE_FIREBASECONFIG_authDomain=tu-proyecto.firebaseapp.com

# API Backend URL
VITE_API_URL=http://localhost:8000/

# LiveKit Server URL
VITE_LIVEKIT_URL=ws://localhost:7880
```

**Nota:** Para produccin, usar URLs seguras (wss:// para LiveKit, https:// para API).

### Ejecucin

#### Modo Desarrollo

Iniciar el servidor de desarrollo:
```bash
npm run dev
```

El frontend estar disponible en `http://localhost:5173` (puerto por defecto de Vite).

#### Modo Produccin

1. Construir la aplicacin:
```bash
npm run build
```

2. Previsualizar la build de produccin:
```bash
npm run preview
```

3. Desplegar: Los archivos generados en `dist/` pueden ser servidos por cualquier servidor web esttico (Nginx, Apache, etc.).

### Verificacin

1. Asegurarse de que el backend est corriendo y accesible en `VITE_API_URL`
2. Asegurarse de que LiveKit est corriendo y accesible en `VITE_LIVEKIT_URL`
3. Abrir el navegador en `http://localhost:5173`
4. Hacer login con Google (si est configurado Firebase)
5. Navegar a `/home` o `/livekit` para acceder al chat

### Solucin de Problemas

**Error: Cannot connect to backend**
- Verificar que `VITE_API_URL` sea correcta
- Verificar que el backend est corriendo
- Verificar CORS en el backend

**Error: Cannot connect to LiveKit**
- Verificar que `VITE_LIVEKIT_URL` sea correcta
- Verificar que LiveKit est corriendo
- Para produccin, usar `wss://` en lugar de `ws://`

**Error: Firebase authentication failed**
- Verificar que las credenciales de Firebase en `.env` sean correctas
- Verificar que el dominio est autorizado en Firebase Console

## Arquitectura

### Servicio Principal: `livekitService.ts`

Servicio singleton que gestiona la conexin a LiveKit, manejo de mensajes y estado de la sesin.

**Estado Reactivo:**
- `isConnected`: Estado de conexin
- `isMicEnabled`: Estado del micrfono
- `agentState`: Estado del agente (disconnected, connecting, listening, thinking, speaking)
- `transcriptions`: Array de transcripciones recibidas

**Mtodos Principales:**

#### `connect(roomName: string, participantName: string): Promise<void>`
Conecta a una sala de LiveKit. Obtiene token del backend y establece conexin WebSocket.

#### `sendTextMessage(text: string): Promise<void>`
Enva mensaje de texto al agente usando text streams (topic `lk.chat`). Auto-conecta si no hay conexin activa.

#### `toggleMicrophone(): Promise<boolean>`
Habilita/deshabilita el micrfono. Retorna el nuevo estado.

#### `disconnect(): Promise<void>`
Desconecta de la sala y limpia recursos.

### Componentes

#### `LiveKitChatView.vue`
Vista principal del chat con LiveKit. Maneja la UI del chat, entrada de texto y estado de conexin.

**Caractersticas:**
- Auto-conexin al enviar mensajes
- Desactiva micrfono automticamente al enviar texto
- Muestra estado del agente en tiempo real
- Maneja mensajes de usuario y agente

#### `VoiceAssistant.vue`
Componente de asistente de voz. Puede usarse como sidebar o componente independiente.

**Props:**
- `roomName`: Nombre de la sala (opcional)
- `participantName`: Nombre del participante (opcional)
- `showTranscriptions`: Mostrar transcripciones (default: true)
- `autoConnect`: Conectar automticamente (default: false)

**Eventos:**
- `@message`: Emite cuando se recibe un mensaje del agente

#### `LiveKitRoom.vue`
Componente wrapper para la integracin de LiveKit.

## Comunicacin con el Backend

### Text Streams

El frontend usa text streams nativos de LiveKit para comunicacin de texto:

**Envo:**
```typescript
await room.localParticipant.sendText(text, {
  topic: 'lk.chat',
});
```

**Recepcin:**
```typescript
room.registerTextStreamHandler('lk.chat', async (reader, participantInfo) => {
  const message = await reader.readAll();
  // Procesar mensaje
});
```

### Eventos Personalizados

El servicio emite eventos personalizados para comunicacin entre componentes:

- `livekit-transcription`: Transcripciones del agente o usuario
- `livekit-agent-message`: Mensajes directos del agente

**Uso:**
```typescript
window.addEventListener('livekit-transcription', (event) => {
  const { text, is_final, participant } = event.detail;
  // Procesar transcripcin
});
```

## Configuracin

### Variables de Entorno

Ver `.env.example` para configuracin completa.

**Requeridas:**
- `VITE_LIVEKIT_URL`: URL del servidor LiveKit (ws://localhost:7880 para local)
- `VITE_API_URL`: URL del backend para obtener tokens

**Opcionales:**
- `VITE_FIREBASECONFIG_*`: Configuracin de Firebase

### Endpoint de Tokens

El backend debe exponer un endpoint POST en `/livekit/token`:

**Request:**
```json
{
  "room_name": "voice-room-123",
  "participant_name": "user-456"
}
```

**Response:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

## Flujo de Comunicacin

### Modo Texto

1. Usuario escribe mensaje
2. Frontend llama `sendTextMessage()`
3. Servicio enva con `sendText()` (topic `lk.chat`)
4. Backend recibe automticamente (AgentSession con `text_input=True`)
5. Agente procesa con LLM
6. Backend enva respuesta como text stream
7. Frontend recibe en `registerTextStreamHandler('lk.chat')`
8. Se muestra en el chat

### Modo Audio

1. Usuario activa micrfono
2. Frontend publica audio track
3. Backend detecta audio y activa modo AUDIO
4. STT transcribe audio
5. LLM procesa transcripcin
6. TTS genera respuesta de voz
7. Frontend reproduce audio del agente

## Estados del Agente

- `disconnected`: No conectado
- `connecting`: Conectando a la sala
- `listening`: Escuchando (modo audio) o esperando mensaje (modo texto)
- `thinking`: Procesando con LLM
- `speaking`: Hablando (modo audio) o generando respuesta (modo texto)

## Manejo de Errores

El servicio maneja errores de conexin y reconexin automtica. Los errores se loguean en consola y el estado se actualiza en `livekitState`.

**Errores comunes:**
- Fallo al obtener token: Verificar que el backend est corriendo
- Fallo de conexin: Verificar URL de LiveKit y firewall
- Timeout: Verificar red y latencia

## Dependencias

- `livekit-client`: ^2.16.0 - SDK oficial de LiveKit para JavaScript
- `vue`: ^3.5.13 - Framework
- `pinia`: ^2.3.0 - State management

## Notas Tcnicas

- El servicio usa text streams nativos de LiveKit, no data packets
- El topic `lk.chat` es el estndar que AgentSession escucha por defecto
- Los mensajes se envan en tiempo real, sin persistencia
- El micrfono se desactiva automticamente al enviar texto para evitar conflictos
</file>

<file path="src/stores/chatStore.ts">
// stores/chatStore.ts
import { defineStore } from "pinia";

export const useChatStore = defineStore("chat", {
  state: () => ({
    messages: [] as { text: string; ia: boolean; error: boolean }[],
    iaIsResponding: false,
    run_id: null as string | null,
    session_id: null as string | null,
    API_URL: "",
    message: "",
  }),
  actions: {
    addMessage(text: string, ia = false, error = false) {
      this.messages.push({ text, ia, error });
    },

    appendStreamToLastMessage(chunk: string) {
        const lastIndex = this.messages.length - 1;
        if (lastIndex >= 0 && this.messages[lastIndex].sender === 'agent') {
            // Aadimos el fragmento al texto existente
            this.messages[lastIndex].text += chunk;
        }
    },
    
    addIaThinkingMessage() {
      this.addMessage("...", true);
    },
    replaceIaMessage(newText: string, error = false) {
      const lastMessage = this.messages[this.messages.length - 1];
      if (lastMessage && lastMessage.ia && lastMessage.text === "...") {
        lastMessage.text = "";
        lastMessage.text = newText;
        lastMessage.error = error;
      }
    },
    clearMessages() {
      this.messages = [];
      this.run_id = null;
      this.session_id = null;
    },
    clearExceptLastMessage() {
      if (this.messages.length > 2) {
        this.messages = [this.messages[this.messages.length - 1]];
      }
    },
    setRunId(id: string) {
      this.run_id = id;
    },
      setSessionId(id: string) {
      this.session_id = id;
    },
  },
  persist: {
    omit: ['session_id'], // Persist everything except session_id and run_id
    pick: ['iaIsResponding', 'messages', 'run_id', 'API_URL', 'message'],
  },
});
</file>

<file path="src/services/notificationService.js">
// src/services/notificationService.js

import { useConversationStore } from '@/stores/conversationStore';

let notificationSocket = null;

export const notificationService = {
  connect(sessionId) {
    if (notificationSocket && notificationSocket.readyState === WebSocket.OPEN) {
      console.log("La conexin de notificaciones ya est abierta.");
      return;
    }

    const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    
    // URLs de backend
    const backendUrlProd = "autoritas-ai-server-main-magnus-process-rafactor-890532438470.europe-southwest1.run.app";
    const backendUrlLocal = 'localhost:8000';

    // Determina el protocolo y la URL correctos segn el entorno
    const protocol = isLocal ? 'ws' : 'wss';
    const targetUrl = isLocal ? backendUrlLocal : backendUrlProd;

    const wsUrl = `${protocol}://${targetUrl}/chat/ws/${sessionId}`;

    console.log(`Intentando conectar a WebSocket en: ${wsUrl}`);
    
    notificationSocket = new WebSocket(wsUrl);

    notificationSocket.onopen = () => {
      console.log("Conexin de notificaciones (Stripe) establecida con xito.");
    };

    notificationSocket.onmessage = (event) => {
      try {
        // --- INICIO DE LA CORRECCIN ---
        // event.data ahora es el texto plano que enva el backend.
        const confirmationText = event.data;
        const conversationStore = useConversationStore();
        
        // Aadimos el mensaje directamente al store.
        // El componente de Vue se encargar de renderizar este texto.
       conversationStore.addMessage(confirmationText, true, false);
        // --- FIN DE LA CORRECCIN ---

      } catch (error) {
        console.error("Error al procesar el mensaje de notificacin:", error);
      }
    };

    notificationSocket.onclose = (event) => {
      console.log("Conexin de notificaciones cerrada.", event.reason);
      notificationSocket = null;
    };

    notificationSocket.onerror = (error) => {
      console.error("Error en el WebSocket de notificaciones:", error);
    };
  },

  disconnect() {
    if (notificationSocket) {
      notificationSocket.close();
    }
  }
};
</file>

<file path="src/services/agentService.js">
// src/services/agentService.js

import { useUserStore } from "@/stores/userStore";
import { useChatStore } from "@/stores/chatStore";
import { signOut, getAuth } from "firebase/auth";
import router from "@/router";

const API_URL = import.meta.env.VITE_API_URL;

/**
 * Realiza una peticin al agente y devuelve la respuesta completa.
 * @param {string} input - El mensaje del usuario.
 * @param {string} model_id - El ID del modelo a utilizar.
 * @returns {Promise<object>} - La respuesta completa del agente.
 */
export async function queryAgent(input, model_id) {
  const userStore = useUserStore();
  const chatStore = useChatStore();

  const payload = {
    input: input,
    session_id: chatStore.session_id,
    model_id: model_id,
     test_ani: "34625454205"
  };

  try {
    const response = await fetch(`${API_URL}invoke`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${userStore.token}`,
        "user_id": userStore.auth_claims,
      },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      if (response.status === 401) {
        console.warn("Unauthorized request. Logging out...");
        const auth = getAuth();
        await signOut(auth);
        userStore.logout();
        router.push("/login");
      }
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    return await response.json(); // Devuelve el JSON completo

  } catch (error) {
    console.error("Error during API request:", error);
    throw error; // Lanza el error para que el store lo maneje
  }
}
</file>

<file path="package.json">
{
  "name": "fldsmdfr.ai.front",
  "private": true,
  "version": "0.0.2",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@headlessui/vue": "^1.7.23",
    "@heroicons/vue": "^2.2.0",
    "@tailwindcss/typography": "^0.5.16",
    "axios": "^1.7.9",
    "chart.js": "^3.9.1",
    "chartjs-plugin-datalabels": "^2.2.0",
    "firebase": "^11.0.1",
    "heroicons": "^2.2.0",
    "highlight.js": "^11.10.0",
    "html2canvas": "^1.4.1",
    "katex": "^0.16.15",
    "livekit-client": "^2.16.0",
    "markdown-it": "^14.1.0",
    "markdown-it-katex-gpt": "^1.1.0",
    "marked": "^15.0.7",
    "pinia": "^2.3.0",
    "pinia-plugin-persistedstate": "^4.1.2",
    "vue": "^3.5.13",
    "vue-chart-3": "^3.1.8",
    "vue-heroicons": "^0.9.4",
    "vue-json-pretty": "^2.5.0",
    "vue-router": "^4.5.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.2.1",
    "autoprefixer": "^10.4.20",
    "postcss": "^8.4.49",
    "tailwindcss": "^3.4.16",
    "vite": "^6.0.1"
  }
}
</file>

<file path="src/router/index.js">
import { createRouter, createWebHistory } from "vue-router";
import LiveKitChatView from "../views/LiveKitChatView.vue";
import Login from "../views/Login.vue";
import { useUserStore } from "../stores/userStore";

const routes = [
  {
    path: "/",
    redirect: "/home",
  },
  {
    path: "/home",
    name: "Chat",
    component: LiveKitChatView,
    meta: { requiresAuth: true },
  },
  {
    path: "/livekit",
    name: "LiveKitChat",
    component: LiveKitChatView,
    meta: { requiresAuth: true },
  },
  {
    path: "/login",
    name: "Login",
    component: Login,
  },
];

const router = createRouter({
  history: createWebHistory(), // Modo de historial HTML5
  routes,
});

// Guardia de navegacin para proteger rutas
router.beforeEach((to, from, next) => {
  const userStore = useUserStore();
  console.log("Intentando ir a:", to.path);
  console.log("Requiere Auth?:", to.meta.requiresAuth);
  console.log("Est autenticado en Store?:", userStore.isAuthenticated);

  if (to.meta.requiresAuth && !userStore.isAuthenticated) {
    console.log("BLOQUEADO: Redirigiendo a login");
    next("/login");
  } else {
    next();
  }
});

export default router;
</file>

<file path="src/stores/conversationStore.js">
import { defineStore } from "pinia";
import MarkdownIt from "markdown-it";
import markdownItKatexGpt from "markdown-it-katex-gpt";
import "katex/dist/katex.min.css";
import { queryAgent } from "@/services/agentService";
import { useCostStore } from "./costStore";
import { notificationService } from "@/services/notificationService";
import { useChatStore } from "./chatStore";

// Configuracin de MarkdownIt para renderizar el texto que llega del backend
const md = new MarkdownIt().use(markdownItKatexGpt, {
  delimiters: [
    { left: "\\[", right: "\\]", display: true },
    { left: "\\(", right: "\\)", display: false },
    { left: "$$", right: "$$", display: false },
  ],
  linkify: true,
  typographer: true,
  breaks: true,
  html: true,
});

export const useConversationStore = defineStore("conversationStore", {
  state: () => ({
    messages: [],
    loading: false,
    iaIsResponding: false,
    error: null,
  }),

  actions: {
    /**
     * Aade un mensaje al array de mensajes del chat.
     * @param {string} text - El contenido del mensaje.
     * @param {boolean} ia - `true` si el mensaje es de la IA.
     * @param {boolean} error - `true` si el mensaje es un error.
     */
    addMessage(text, ia = false, error = false) {
      this.messages.push({
        text,
        ia,
        error,
        image: null,
        chart: null,
        table: null,
        debugData: null,
        timestamp: new Date().toLocaleTimeString(),
        responseTime: null,
      });
    },

    /**
     * Maneja el envo de un nuevo mensaje del usuario y la respuesta de la IA.
     * @param {string} userMessage - El mensaje escrito por el usuario.
     * @param {string} model_id - El ID del modelo de lenguaje seleccionado.
     */
    async handleNewMessage(userMessage, model_id) {
      if (!userMessage.trim()) return;

      const startTime = Date.now();
      this.addMessage(userMessage);
      this.addMessage("...", true); // Placeholder para la respuesta de la IA
      this.iaIsResponding = true;
      this.error = null;

      try {
        // Llama al servicio del agente que devuelve una respuesta JSON completa
        const result = await queryAgent(userMessage, model_id);
        const lastMessage = this.messages[this.messages.length - 1];

        if (lastMessage && lastMessage.ia) {
          // 1. Actualiza el mensaje con la respuesta de texto de la IA
          lastMessage.text = result.response ? md.render(result.response) : "";

          // 2. Almacena los datos estructurados para vue-json-pretty
          lastMessage.debugData = result.structured_data || null;

          // 3. Calcula y almacena el tiempo de respuesta
          const endTime = Date.now();
          lastMessage.responseTime = endTime - startTime;

          // Actualiza el coste total (si es necesario)
          const costStore = useCostStore();
          if (result.request_cost) {
            costStore.addCost(result.request_cost);
          }

          // 4. Establece el ID de sesin y conecta el WebSocket
          const chatStore = useChatStore();
          if (result.session_id) {
            chatStore.setSessionId(result.session_id);
            notificationService.connect(result.session_id);
          }
        }
      } catch (error) {
        this.error = error.message;
        const lastMessage = this.messages[this.messages.length - 1];
        if (lastMessage && lastMessage.ia) {
          lastMessage.error = true;
          lastMessage.text = `Error: ${error.message}`;
        }
        console.error("Error al manejar el nuevo mensaje:", error);
      } finally {
        this.iaIsResponding = false;
      }
    },

    /**
     * Utilidad para limpiar etiquetas HTML de un string, si fuera necesario.
     * @param {string} html - El string con HTML.
     * @returns {string} - El texto plano sin HTML.
     */
    stripHTML(html) {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, "text/html");
      return doc.body.textContent || "";
    },
  },
});
</file>

<file path="src/services/livekitService.ts">
import { reactive, ref, type Ref } from 'vue';
import {
  Room,
  RoomEvent,
  Track,
  RemoteTrack,
  RemoteTrackPublication,
  RemoteParticipant,
  LocalParticipant,
  LocalTrackPublication,
  ConnectionState,
  DisconnectReason,
  type RoomOptions,
  type AudioCaptureOptions,
  DataPacket_Kind,
} from 'livekit-client';

// Estado reactivo compartido
export const livekitState = reactive({
  isConnected: false,
  isConnecting: false,
  isMicEnabled: false,
  connectionState: 'disconnected' as string,
  agentState: 'disconnected' as 'disconnected' | 'connecting' | 'listening' | 'thinking' | 'speaking',
  transcriptions: [] as Array<{
    segment_id: string;
    text: string;
    is_final: boolean;
    participant: string;
  }>,
});

// Tipos para los tracks
export interface TrackInfo {
  trackPublication: RemoteTrackPublication;
  participantIdentity: string;
}

class LiveKitService {
  private room: Room | null = null;
  private audioElement: HTMLAudioElement | null = null;

  // URLs configurables
  private livekitUrl: string;
  private tokenEndpoint: string;

  constructor() {
    // Token server endpoint (debe estar configurado en VITE_API_URL)
    this.tokenEndpoint = (import.meta.env.VITE_API_URL || 'https://livekit-backend-unified-main-sfubuvmfmq-no.a.run.app').replace(/\/$/, '');
    console.log(' Token Server URL:', this.tokenEndpoint);

    // NOTA: La URL de LiveKit viene del token-server, no se usa VITE_LIVEKIT_URL
    // Se mantiene solo como referencia interna (no se usa realmente)
    this.livekitUrl = import.meta.env.VITE_LIVEKIT_URL || 'wss://34.175.108.243:443';
  }

  /**
   * Obtiene un token de acceso del servidor y la URL de LiveKit
   */
  async getToken(roomName: string, participantName: string): Promise<{ token: string; url: string }> {
    const response = await fetch(`${this.tokenEndpoint}/livekit/token`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        room_name: roomName,
        participant_name: participantName,
      }),
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(`Failed to get token: ${error.detail || error.message}`);
    }

    const data = await response.json();

    if (!data.token) {
      throw new Error('El token-server no devolvi un token');
    }

    if (!data.url) {
      throw new Error('El token-server no devolvi una URL');
    }

    // CRTICO: Usar la URL devuelta por el token-server directamente
    console.log(' LiveKit URL desde servidor:', data.url);

    return { token: data.token, url: data.url };
  }

  /**
   * Conecta a una sala de LiveKit
   */
  async connect(roomName: string, participantName: string): Promise<void> {
    if (this.room && this.room.state === ConnectionState.Connected) {
      console.warn('Ya existe una conexin activa a LiveKit');
      return;
    }

    livekitState.isConnecting = true;
    livekitState.agentState = 'connecting';

    try {
      // Obtener token y URL del servidor
      const { token, url } = await this.getToken(roomName, participantName);

      console.log(' Token obtenido, conectando a:', url);

      // Crear nueva instancia de Room
      this.room = new Room({
        adaptiveStream: true,
        dynacast: true,
        audioCaptureDefaults: {
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true,
        },
      });

      // Configurar event listeners
      this.setupEventListeners();

      // Conectar a la sala usando la URL devuelta por el token-server
      await this.room.connect(url, token);

      console.log('Conectado a LiveKit room:', this.room.name);
      livekitState.isConnected = true;
      livekitState.isConnecting = false;
      livekitState.connectionState = 'connected';
      livekitState.agentState = 'listening';

    } catch (error) {
      console.error('Error conectando a LiveKit:', error);
      livekitState.isConnecting = false;
      livekitState.isConnected = false;
      livekitState.agentState = 'disconnected';
      throw error;
    }
  }

  /**
   * Configura los event listeners de la sala
   */
  private setupEventListeners(): void {
    if (!this.room) return;

    // Cuando se suscribe a un track remoto
    this.room.on(RoomEvent.TrackSubscribed, (track, publication, participant) => {
      console.log('Track suscrito:', track.kind, 'de', participant.identity);

      if (track.kind === Track.Kind.Audio) {
        // Crear elemento de audio para reproducir el audio del agente
        this.audioElement = track.attach() as HTMLAudioElement;
        document.body.appendChild(this.audioElement);
      }
    });

    // Cuando se desuscribe de un track
    this.room.on(RoomEvent.TrackUnsubscribed, (track, publication, participant) => {
      console.log('Track desuscrito:', track.kind);
      track.detach();
    });

    // Cambios en el estado de la conexin
    this.room.on(RoomEvent.ConnectionStateChanged, (state) => {
      console.log('Estado de conexin:', state);
      livekitState.connectionState = state;
      livekitState.isConnected = state === ConnectionState.Connected;
    });

    // Desconexin
    this.room.on(RoomEvent.Disconnected, (reason) => {
      const reasonStr = reason !== undefined ? DisconnectReason[reason] || String(reason) : 'unknown';
      console.log('Desconectado de LiveKit:', reason, 'Razn:', reasonStr);

      // Solo limpiar si no es una desconexin manual
      if (reason !== DisconnectReason.CLIENT_INITIATED) {
        console.warn('Desconexin inesperada. Razn:', reasonStr);
      }

      livekitState.isConnected = false;
      livekitState.agentState = 'disconnected';
      livekitState.isMicEnabled = false;
      this.cleanup();
    });

    // Datos recibidos (transcripciones, estado del agente, etc.)
    this.room.on(RoomEvent.DataReceived, (payload, participant, kind, topic) => {
      try {
        const data = JSON.parse(new TextDecoder().decode(payload));
        this.handleDataMessage(data, participant?.identity || 'unknown');
      } catch (e) {
        console.error('Error parsing data message:', e);
      }
    });

    // Transcripciones (si el agente las enva)
    this.room.on(RoomEvent.TranscriptionReceived, (segments, participant, publication) => {
      segments.forEach(segment => {
        // Solo procesar transcripciones finales para evitar duplicados
        if (!segment.final) return;

        const participantId = participant?.identity || 'unknown';
        const segmentId = segment.id || `seg-${Date.now()}-${Math.random()}`;

        // Crear una clave nica basada en texto + participant + segment_id
        const uniqueKey = `${participantId}-${segmentId}-${segment.text.trim()}`;

        // Verificar si ya existe esta transcripcin exacta
        const existingIndex = livekitState.transcriptions.findIndex(
          t => t.segment_id === segmentId ||
            (t.participant === participantId && t.text.trim() === segment.text.trim())
        );

        if (existingIndex >= 0) {
          // Ya existe, no emitir de nuevo
          console.log('Transcripcin duplicada ignorada:', segment.text.substring(0, 50));
          return;
        }

        const transcription = {
          segment_id: segmentId,
          text: segment.text,
          is_final: segment.final,
          participant: participantId,
        };

        livekitState.transcriptions.push(transcription);

        // Emitir evento para la UI
        window.dispatchEvent(new CustomEvent('livekit-transcription', {
          detail: transcription
        }));
      });
    });

    // Cambios en los participantes
    this.room.on(RoomEvent.ParticipantConnected, (participant) => {
      console.log('Participante conectado:', participant.identity);
    });

    this.room.on(RoomEvent.ParticipantDisconnected, (participant) => {
      console.log('Participante desconectado:', participant.identity);
    });

    // Active speakers (para indicador visual)
    this.room.on(RoomEvent.ActiveSpeakersChanged, (speakers) => {
      const agentSpeaking = speakers.some(s => s.identity.includes('agent'));
      if (agentSpeaking) {
        livekitState.agentState = 'speaking';
      } else if (livekitState.agentState === 'speaking') {
        livekitState.agentState = 'listening';
      }
    });

    // Registrar handler para text streams (respuestas de texto del agente)
    // El agente enva respuestas de texto en el topic lk.chat o lk.transcription
    this.room.registerTextStreamHandler('lk.chat', (reader, participantInfo) => {
      // Usar una funcin async inmediatamente invocada para manejar el async/await
      (async () => {
        try {
          const message = await reader.readAll();
          const participantId = participantInfo?.identity || 'unknown';

          console.log(' Mensaje de texto recibido del agente:', message);

          // Emitir evento para que la UI lo procese
          window.dispatchEvent(new CustomEvent('livekit-agent-message', {
            detail: message
          }));

          // Tambin emitir como transcripcin para compatibilidad
          window.dispatchEvent(new CustomEvent('livekit-transcription', {
            detail: {
              text: message,
              is_final: true,
              participant: participantId,
              segment_id: `text-${Date.now()}`,
            }
          }));
        } catch (error) {
          console.error('Error leyendo text stream:', error);
        }
      })();
    });

    // Tambin registrar handler para transcripciones (por si el agente las enva)
    this.room.registerTextStreamHandler('lk.transcription', (reader, participantInfo) => {
      (async () => {
        try {
          const message = await reader.readAll();
          const participantId = participantInfo?.identity || 'unknown';
          const isFinal = reader.info.attributes?.['lk.transcription_final'] === 'true';

          if (isFinal) {
            console.log(' Transcripcin final recibida:', message);

            window.dispatchEvent(new CustomEvent('livekit-transcription', {
              detail: {
                text: message,
                is_final: true,
                participant: participantId,
                segment_id: reader.info.attributes?.['lk.segment_id'] || `transcription-${Date.now()}`,
              }
            }));
          }
        } catch (error) {
          console.error('Error leyendo transcription stream:', error);
        }
      })();
    });
  }

  /**
   * Maneja mensajes de datos del agente
   */
  private handleDataMessage(data: any, participantIdentity: string): void {
    // El agente puede enviar diferentes tipos de mensajes
    if (data.type === 'agent_state') {
      livekitState.agentState = data.state;
    } else if (data.type === 'ui_directive') {
      // NEW: UI directive from CADE for widget rendering
      console.log(' UI Directive received:', data.directive);
      window.dispatchEvent(new CustomEvent('livekit-ui-directive', {
        detail: data.directive
      }));
    } else if (data.type === 'agent_text_response') {
      // Respuesta de texto del agent (sin TTS) - para mensajes de chat
      window.dispatchEvent(new CustomEvent('livekit-agent-message', {
        detail: data.text
      }));
      // Tambin emitir como transcripcin para que aparezca en el chat
      window.dispatchEvent(new CustomEvent('livekit-transcription', {
        detail: {
          text: data.text,
          is_final: true,
          participant: participantIdentity,
          segment_id: `text-response-${Date.now()}`,
        }
      }));
    } else if (data.type === 'transcription') {
      // Solo procesar transcripciones finales y evitar duplicados con TranscriptionReceived
      // Las transcripciones ya vienen por TranscriptionReceived, as que ignoramos estas
      // para evitar duplicados
      if (data.is_final) {
        // Verificar si ya existe en transcripciones para evitar duplicados
        const exists = livekitState.transcriptions.some(
          t => t.text === data.text && t.participant === participantIdentity
        );
        if (!exists) {
          window.dispatchEvent(new CustomEvent('livekit-transcription', {
            detail: {
              text: data.text,
              is_final: data.is_final,
              participant: participantIdentity,
              segment_id: `data-${Date.now()}-${data.text}`, // Generar ID nico
            }
          }));
        }
      }
    } else if (data.type === 'agent_message') {
      window.dispatchEvent(new CustomEvent('livekit-agent-message', {
        detail: data.message
      }));
    }
  }

  /**
   * Habilita/deshabilita el micrfono
   */
  async toggleMicrophone(): Promise<boolean> {
    if (!this.room || !this.room.localParticipant) {
      console.error('No hay conexin activa');
      return false;
    }

    try {
      if (livekitState.isMicEnabled) {
        await this.room.localParticipant.setMicrophoneEnabled(false);
        livekitState.isMicEnabled = false;
      } else {
        await this.room.localParticipant.setMicrophoneEnabled(true);
        livekitState.isMicEnabled = true;
      }
      return livekitState.isMicEnabled;
    } catch (error) {
      console.error('Error toggling microphone:', error);
      return livekitState.isMicEnabled;
    }
  }

  /**
   * Habilita el micrfono
   */
  async enableMicrophone(): Promise<void> {
    if (!this.room || !this.room.localParticipant) {
      throw new Error('No hay conexin activa');
    }

    await this.room.localParticipant.setMicrophoneEnabled(true);
    livekitState.isMicEnabled = true;
  }

  /**
   * Deshabilita el micrfono
   */
  async disableMicrophone(): Promise<void> {
    if (!this.room || !this.room.localParticipant) {
      return;
    }

    await this.room.localParticipant.setMicrophoneEnabled(false);
    livekitState.isMicEnabled = false;
  }

  /**
   * Enva un mensaje de texto al agent via data channel
   * Auto-conecta si no hay conexin activa
   * @param text - Message text to send
   * @param options - Optional settings
   * @param options.keepMicEnabled - If true, don't disable microphone when sending (useful for widget clicks)
   */
  async sendTextMessage(text: string, options?: { keepMicEnabled?: boolean }): Promise<void> {
    // Auto-conectar si no hay conexin
    if (!this.room || !this.room.localParticipant) {
      console.log('Auto-conectando para enviar mensaje de texto...');
      try {
        // Generar room y participant name
        const roomName = `voice-room-${Date.now()}`;
        const participantName = `user-${Math.floor(Math.random() * 1000)}`;

        await this.connect(roomName, participantName);

        // Esperar un poco para que la conexin se establezca
        await new Promise(resolve => setTimeout(resolve, 500));
      } catch (error) {
        console.error('Error auto-conectando:', error);
        throw new Error('No se pudo conectar para enviar el mensaje');
      }
    }

    if (!this.room || !this.room.localParticipant) {
      throw new Error('No hay conexin activa despus de intentar conectar');
    }

    // Solo desactivar micrfono si no se especifica keepMicEnabled
    if (!options?.keepMicEnabled && livekitState.isMicEnabled) {
      await this.disableMicrophone();
    }

    console.log(' Enviando mensaje de texto al agent (lk.chat):', text);
    // Usar sendText con el topic lk.chat que es el que AgentSession escucha por defecto
    await this.room.localParticipant.sendText(text, {
      topic: 'lk.chat',
    });
  }

  /**
   * Limpia recursos
   */
  private cleanup(): void {
    if (this.audioElement) {
      this.audioElement.remove();
      this.audioElement = null;
    }
  }

  /**
   * Desconecta de la sala
   */
  async disconnect(): Promise<void> {
    this.cleanup();

    if (this.room) {
      await this.room.disconnect();
      this.room = null;
    }

    livekitState.isConnected = false;
    livekitState.isMicEnabled = false;
    livekitState.agentState = 'disconnected';
    livekitState.transcriptions = [];
  }

  /**
   * Obtiene la sala actual
   */
  getRoom(): Room | null {
    return this.room;
  }
}

// Exportar instancia singleton
export const livekitService = new LiveKitService();
</file>

<file path="cloudbuild.yaml">
---
steps:
  - id: install_packages
    name: "node:18.17.1"
    entrypoint: npm
    args:
      - "ci"

  - id: build_browser_files
    name: "node:18.17.1"
    entrypoint: npm
    args:
      - "run"
      - "build"
    env:
      - "VITE_API_URL=https://livekit-backend-unified-main-sfubuvmfmq-no.a.run.app"
      - "VITE_LIVEKIT_URL=wss://34.175.108.243:443"
    waitFor:
      - install_packages

  - id: copy_prerendered_files
    name: "gcr.io/cloud-builders/gsutil"
    args:
      [
        "-m",
        "rsync",
        "-u",
        "-d",
        "-x",
        '^\.git/|\.gitignore.*$',
        "-r",
        "${_APP_COMPILED_FOLDER}",
        "${_APP_BUCKET_PATH}",
      ]
    waitFor:
      - build_browser_files

  - id: set_no_cache
    name: "gcr.io/cloud-builders/gsutil"
    args:
      - setmeta
      - -h
      - "cache-control:no-cache, max-age=0, no-transform"
      - ${_APP_BUCKET_PATH}/*
    waitFor:
      - copy_prerendered_files

  - id: set_cors
    name: "gcr.io/cloud-builders/gsutil"
    args:
      - cors
      - set
      - cors.json
      - ${_APP_BUCKET_PATH}
    waitFor:
      - build_browser_files

#  - id: set_content_encoding
#    name: 'gcr.io/cloud-builders/gsutil'
#    args:
#      - setmeta
#      - -h
#      - 'Content-Encoding: br'
#      - gs://${_APP_BUCKET_NAME}**/*.br
#    waitFor:
#      - build_browser_files

substitutions:
  _APP_COMPILED_FOLDER: ./dist/
  _APP_BUCKET_PATH: gs://_BUCKET_NAME_HERE
options:
  dynamic_substitutions: true
  logging: CLOUD_LOGGING_ONLY
</file>

</files>
